!function(e){var t={};function n(i){if(t[i])return t[i].exports;var a=t[i]={i:i,l:!1,exports:{}};return e[i].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:i})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){n(1),e.exports=n(2)},function(e,t){!function(){var e=1e4;var t={DocModeType:{NormalMode:0,FreeMode:1},dpc:{},fastMode:!1,init:function(){this.dpc=new Dpc},appendDrawPanel:function(){var e='<iframe id="dpa" allow-scripts allowfullscreen allowusermedia frameborder="0" style="width: 100%;height:100%;"></iframe>';"isMobile"==m.isMobile()&&(e='<iframe id="dpa" allow-scripts allowfullscreen allowusermedia frameborder="0" style="width: 100%;height:100%;pointer-events: none;"></iframe>'),$("#drawPanel").parent().append(e),$("div#drawPanel").remove(),"function"==typeof window.on_cc_live_db_flip&&window.on_cc_live_db_flip()},pageChange:function(e){this.fastMode&&this.dpc.pageChange(e)},animationChange:function(e){this.fastMode&&this.dpc.animationChange(e)},history:function(e){this.fastMode&&this.dpc.history(e)},draw:function(e){this.fastMode&&this.dpc.draw(e)},clear:function(){this.fastMode&&this.dpc.clear()},reload:function(){this.fastMode&&this.dpc.reload()},setDocMode:function(e){this.fastMode&&this.dpc.setFreeDocMode(e)},getDocs:function(e){this.fastMode&&this.dpc.getDocs(n.roomid,n.userid,e)},changePageTo:function(e,t){this.fastMode&&this.dpc.changePageTo(e,t)}},n={DocModeType:{NormalMode:0,FreeMode:1},init:function(e){void 0===e&&(e={}),this.userid=$.trim(e.userid),this.roomid=$.trim(e.roomid),this.viewername=$.trim(e.viewername),this.viewertoken=$.trim(e.viewertoken),this.forcibly=$.trim(e.forcibly),this.viewercustomua=$.trim(e.viewercustomua),this.language=$.trim(e.language),this.viewercustominfo=$.trim(e.viewercustominfo),this.ua=$.trim(e.ua),this.viewerid=$.trim(e.viewerid),this.upid=$.trim(e.upid),"string"==typeof e.fastMode?"false"===e.fastMode?this.fastMode=!1:this.fastMode=!0:"boolean"==typeof e.fastMode?this.fastMode=e.fastMode:this.fastMode=!1,t.fastMode=this.fastMode;var i=this,a=["//static.csslcloud.net/js/socket.io.js","//static.csslcloud.net/js/report.js"];if("isMobile"==m.isMobile())$("#drawPanel").length>0&&(t.fastMode||a.push("//static.csslcloud.net/js/module/drawingBoard-2.0.0.js"));else{if(!function(){var e=!0;if(navigator.appVersion.indexOf("MSIE")>=0)try{new ActiveXObject("ShockwaveFlash.ShockwaveFlash")}catch(t){e=!1}else navigator.plugins["Shockwave Flash"]||(e=!1);return e}()&&("function"==typeof n.onNotSupportFlash&&n.onNotSupportFlash(),"18452D400D6B81D5"==this.userid)){var s=$("#"+o.id).parent().height(),r=$("#"+o.id).parent().width();$("#"+o.id).append('<div style="z-index: 999999;"><p style="color: #0e0e0e; width: 260px;">您还没有安装flash播放器,请点击<a href="http://www.adobe.com/go/getflash" style="color: red;" target="_blank">这里</a>安装</p></div>').parent().css("z-index","999999");var c=$($("#"+o.id+" div p")[0]).height(),l=$($("#"+o.id+" div p")[0]).width();$("#"+o.id+" div").css({"margin-left":(r-l-60)/2+"px","margin-top":(s-c)/2+"px"}),setInterval(function(){$("#"+o.id).parent().show()},3e3)}a.push("//static.csslcloud.net/js/swfobject.js","//static.csslcloud.net/js/json3.min.js")}i.loadScript(a,function(){if(i.login(function(){i.history=new d}),"isMobile"==m.isMobile()&&$.DrawingBoard){$("#drawPanel").parent().append('<canvas id="drawPanel" width="1200" height="1200" style="position: absolute;z-index:2;top:0;left: 0"></canvas><iframe id="dpa" src="" frameborder="0" style="position: absolute;top:0;left: 0"></iframe>'),$("div#drawPanel").remove(),$.DrawingBoard.config()}})},login:function(i){$.ajax({url:"//view.csslcloud.net/api/room/login",type:"GET",dataType:"jsonp",data:{roomid:this.roomid,userid:this.userid,viewername:this.viewername,viewertoken:this.viewertoken,forcibly:this.forcibly,viewercustomua:this.viewercustomua,viewercustominfo:this.viewercustominfo},success:function(r){if(r.success){var c="https:"===window.location.protocol,l=r.datas.pusherNode.primary;if(c&&l&&l.indexOf(":")){var u=l.split(":");if(2==u.length){var d=parseInt(u[1]);if(!isNaN(d)){var f=d+400;l=u[0]+":"+f}}}var g=document.location.protocol+"//"+l+"/"+r.datas.pusher.nsp,v=r.datas.viewer.key;a.options.pusherUrl=g,a.options.key=v,n.viewerid=r.datas.viewer.id,n.viewername=r.datas.viewer.name,n.isBan=r.datas.room.isBan,n.liveid=r.datas.liveId,n.upid=r.datas.upId,n.multiQuality=r.datas.room.multiQuality,n.documentDisplayMode=r.datas.room.documentDisplayMode,n.liveCountdown=r.datas.room.liveCountdown,t.fastMode&&($("#documentDisplayMode").val(n.documentDisplayMode),t.appendDrawPanel(),t.init()),i();var w=r.datas.room.delayTime,y=r.datas.room.foreignPublish;o.delay=w,w<=0&&(e=5e3),o.foreignPublish=y,o.openHostMode=r.datas.room.openHostMode,o.dvr=r.datas.room.dvr,o.barrageData=r.datas.room.barrage,o.warmVideoId=r.datas.room.encryptWarmVideoId,o.viewerid=r.datas.viewer.id;var _=r.datas.room.playerBackgroundImageUri;if(_)(c="https:"===window.location.protocol)&&(_=_.replace(/http:/g,"https:"));else _="";o.backgroundImageUri=_,"function"==typeof n.playerBackgroundImageUri&&n.playerBackgroundImageUri(_);var b=r.datas.room.playerBackgroundHint;b||(b=""),o.backgroundHint=b,"function"==typeof n.playerBackgroundHint&&n.playerBackgroundHint(b);var I=r.datas.announcement;"function"==typeof n.onAnnouncementShow&&I&&n.onAnnouncementShow(I);var P=r.datas.room.desc;"function"==typeof n.onLiveDesc&&n.onLiveDesc(P);var M=r.datas.room.showUserCount;"function"==typeof n.showUserCount&&n.showUserCount(M);var S=r.datas.viewer.marquee;"function"==typeof n.getMarquee&&n.getMarquee(S),"function"==typeof n.onLoginSuccess&&n.onLoginSuccess();var k=r.datas.live;switch("function"==typeof n.onLiveTime&&n.onLiveTime(k),a.init(),"isMobile"==m.isMobile()?m.init():o.init(),r.datas.template.type){case 6:p.init(),n.sendPublicChatMsg=n.sendPrivateChatMsg=function(){return!1};break;case 5:h.init(),p.init(),s.init();break;case 4:h.init(),s.init(),n.sendQuestionMsg=function(){return!1};break;case 3:h.init(),n.sendQuestionMsg=function(){return!1};break;case 2:h.init(),p.init();break;default:h.init(),p.init(),s.init()}}else"function"==typeof n.onLoginError&&n.onLoginError(r)}})},logout:function(){$.ajax({url:"//view.csslcloud.net/api/live/logout",type:"GET",dataType:"json",timeout:5e3,xhrFields:{withCredentials:!0},success:function(e){},error:function(e,t,n){}})},getScript:function(e,t){var n=!1,i=document.createElement("script");i.src=e,i.onload=i.onreadystatechange=function(){n||this.readyState&&"loaded"!=this.readyState&&"complete"!=this.readyState||(n=!0,t&&t())},document.body.appendChild(i)},loadScript:function(e,t){if("string"==typeof e){var n=e;(e=[]).push(n)}var i=this,a=function(e,t){i.getScript(e.shift(),function(){e.length?a(e,t):t&&t()})};a(e,t)},changeNickname:function(e){if(!e||"string"!=typeof e||e.length>20)return!1;a.socket.emit("change_nickname",e)},sendPublicChatMsg:function(e){!e||e.length>300||a.socket.emit("chat_message",e)},sendPrivateChatMsg:function(e,t,n){var i=(new Date).getHours(),o=(new Date).getMinutes(),s=(new Date).getSeconds();o=o>9?o:"0"+o,s=s>9?s:"0"+s;var r={fromuserid:this.viewerid,fromusername:this.viewername,touserid:e,tousername:t,msg:$.trim(n),time:i+":"+o+":"+s};a.socket.emit("private_chat",JSON.stringify(r))},sendQuestionMsg:function(e){if(e&&!(e.length>300)){var t={action:"question",value:{userId:this.viewerid,userName:this.viewername,content:e}};try{a.socket.emit("question",JSON.stringify(t))}catch(e){}}},barrage:function(e,t){if("isMobile"!=m.isMobile()){var n=$.trim(e);n&&(n=e.replace(/\[em2?_([0-9]*)\]/g,""),o.barrage({txt:n,color:null==t?16777215:t}))}},getLine:function(){return"isMobile"==m.isMobile()?m.src:o.getLine()},changeLine:function(e){"isMobile"==m.isMobile()?m.changeLine(e):o.changeLine(e)},onlyAudio:function(){"isMobile"==m.isMobile()?m.onlyAudio():o.onlyAudio()},setSound:function(e){"isMobile"!=m.isMobile()&&o.setSound(e)},answerRollcall:function(e,t){var n={rollcallId:e,userId:this.viewerid,userName:this.viewername,publisherId:t};a.socket.emit("answer_rollcall",JSON.stringify(n))},replyVote:function(e,t,n){var i={voteId:e,voteOption:t,publisherId:n};a.socket.emit("reply_vote",JSON.stringify(i))},docBarrage:function(e,t){$.trim(e)&&s.barrage({txt:e,color:null==t?16777215:t})},openBarrage:function(e){o.openBarrage(e)},showControl:function(e){o.showControl(e)},livePlayerInit:function(){o.init()},openSound:function(){o.openSound()},closeSound:function(){o.closeSound()},docAdapt:function(e){f.adapt=e},requestInteraction:function(e){f.interaction.requestInteraction(e)},hangupInteraction:function(){f.interaction.hangupInteraction()},enterInteractionRoom:function(e){var t=void 0;try{a.socket.emit("speak_enter")}catch(e){t=e}finally{"function"==typeof e&&e(t)}},sendInteractionMessage:function(e,t,n,i,o){var s="audio";e.video&&(s="audiovideo");var r={type:s,fromname:this.viewername,fromid:this.viewerid,fromrole:"student",toid:t,event:n,data:JSON.stringify(i)},c=void 0;try{a.socket.emit("speak_message",JSON.stringify(r))}catch(e){c=e}finally{"function"==typeof o&&o(c)}},showMarquee:function(e){o.showMarquee(e)},showMarqueeDoc:function(e){s.showMarquee(e)},setDocMode:function(e){t.fastMode&&t.setDocMode(e)},getDocs:function(e){t.fastMode&&t.getDocs(e)},changePageTo:function(e,n){t.fastMode&&t.changePageTo(e,n)},submitQuestionnaire:function(e,t){if(e){var n={questionnaireid:e.questionnaireId,answers:JSON.stringify({subjectsAnswer:e.subjectsAnswer})};$.ajax({url:"//eva.csslcloud.net/api/questionnaire/submit",type:"GET",dataType:"jsonp",timeout:5e3,data:n,xhrFields:{withCredentials:!0},success:function(e){t?t(e):console.log&&console.log("no callback")},error:function(e,n,i){t&&t({errorCode:1,msg:"request was aborted",result:i})}})}},getPublishingQuestionnaire:function(){$.ajax({url:"//eva.csslcloud.net/api/questionnaire/info",type:"GET",dataType:"jsonp",xhrFields:{withCredentials:!0},success:function(e){e.success&&("function"==typeof n.onQuestionnairePublish?n.onQuestionnairePublish(e):console.log&&console.log("onQuestionnairePublish is undefined"))},error:function(e){"function"==typeof n.onQuestionnairePublish?n.onQuestionnairePublish({errorCode:1,msg:"request error",result:e}):console.log&&console.log("onQuestionnairePublish is undefined")}})}},i={init:function(){this.userId=n.userid,this.roomId=n.roomid,this.liveId=n.liveid,this.viewerId=n.viewerid,this.upId=n.upid}},a={options:{pusherUrl:"",key:"",maxMessageCount:300,userId:"",roomId:"",livePlayerId:"",drawPanel:""},drawjson:[],pagechangedata:[],init:function(){var e="isMobile"==m.isMobile()?1:0;this.socket=io.connect(this.options.pusherUrl,{query:{sessionid:a.options.key,platform:1,terminal:e}}),this.bind()},bind:function(){this.socket.on("page_change",function(e){if(e&&"string"==typeof e&&a.pagechangedata.push(JSON.parse(e)),"function"==typeof window.on_cc_live_dw_page_change&&window.on_cc_live_dw_page_change(e),"function"==typeof n.onPageChange){var t=JSON.parse(e),i={docId:t.value.docid,docName:t.value.fileName,docTotalPage:t.value.totalPage,pageNum:t.value.page};n.onPageChange(i)}}),this.socket.on("change_nickname",function(e){n.viewername=e,"function"==typeof n.onChangeNickname&&n.onChangeNickname(e)}),this.socket.on("animation_change",function(e){"function"==typeof window.on_cc_live_dw_animation_change&&window.on_cc_live_dw_animation_change(e)}),this.socket.on("draw",function(e){e&&"string"==typeof e&&a.drawjson.push(JSON.parse(e)),"function"==typeof window.on_cc_live_dw_draw&&window.on_cc_live_dw_draw(e)}),this.socket.on("room_user_count",function(e){"function"==typeof n.onUserCountMessage&&n.onUserCountMessage(e)}),this.socket.on("publish_stream",function(e){o&&(o.isPublishing=1),o&&o.start&&o.start(),"function"==typeof n.onLiveStart&&n.onLiveStart(e)}),this.socket.on("end_stream",function(e){o&&(o.isPublishing=0),o&&o.end&&o.end(),s&&s.clear&&s.clear(),t.clear(),"function"==typeof n.onLiveEnd&&n.onLiveEnd(e)}),this.socket.on("kick_out",function(e){console.log(e),a.socket.disconnect(),"function"==typeof n.onKickOut&&n.onKickOut(e),m.isIPad()||m.isIPhone()||m.isAndroid()||m.isWindowsPhone()||o.getFlash()._kickOff()}),this.socket.on("announcement",function(e){"release"==(e=w(e)).action?"function"==typeof n.onAnnouncementRelease&&n.onAnnouncementRelease(e.announcement):"remove"==e.action&&"function"==typeof n.onAnnouncementRemove&&n.onAnnouncementRemove(e)}),this.socket.on("start_rollcall",function(e){e=w(e),"function"==typeof n.onStartRollCall&&n.onStartRollCall(e)}),this.socket.on("start_lottery",function(e){e=w(e),"function"==typeof n.onStartLottery&&n.onStartLottery(e)}),this.socket.on("win_lottery",function(e){e=w(e),"function"==typeof n.onWinLottery&&n.onWinLottery(e)}),this.socket.on("stop_lottery",function(e){e=w(e),"function"==typeof n.onStopLottery&&n.onStopLottery(e)}),this.socket.on("start_vote",function(e){e=w(e),"function"==typeof n.onStartVote&&n.onStartVote(e)}),this.socket.on("stop_vote",function(e){e=w(e),"function"==typeof n.onStopVote&&n.onStopVote(e)}),this.socket.on("vote_result",function(e){e=w(e),"function"==typeof n.onVoteResult&&n.onVoteResult(e)}),this.socket.on("ban_stream",function(e){e=w(e),n.isBan=1,"isMobile"==m.isMobile()?m.ban():o.banLive(),"function"==typeof n.onBanStream&&n.onBanStream(e)}),this.socket.on("unban_stream",function(e){e=w(e),n.isBan=0,"isMobile"==m.isMobile()?m.unban():o.unbanLive(),"function"==typeof n.onUnBanStream&&n.onUnBanStream(e)}),this.socket.on("room_setting",function(e){e=w(e),"function"==typeof n.onRoomSetting&&n.onRoomSetting(e)}),this.socket.on("accept_speak",function(e){"function"==typeof window.on_cc_live_accept_interaction&&window.on_cc_live_accept_interaction(w(e))}),this.socket.on("speak_message",function(e){"function"==typeof window.on_cc_live_interaction_message&&window.on_cc_live_interaction_message(w(e))}),this.socket.on("speak_peer_list",function(e){"function"==typeof window.on_cc_live_interaction_chatusers&&window.on_cc_live_interaction_chatusers(w(e))}),this.socket.on("speak_disconnect",function(e){"function"==typeof window.on_cc_live_interaction_disconnect&&window.on_cc_live_interaction_disconnect(w(e))}),this.socket.on("broadcast_msg",function(e){"function"==typeof n.onBroadcastMsg&&n.onBroadcastMsg(w(e).value)}),this.socket.on("publish_question",function(e){"function"==typeof n.onQaPublish&&n.onQaPublish(w(e))}),this.socket.on("questionnaire_publish",function(e){e=w(e),"function"==typeof n.onQuestionnairePublish&&n.onQuestionnairePublish(e)}),this.socket.on("questionnaire_publish_stop",function(e){e=w(e),"function"==typeof n.onQuestionnairePublishStop&&n.onQuestionnairePublishStop(e)}),this.socket.on("questionnaire_publish_statis",function(e){e=w(e),"function"==typeof n.onQuestionnairePublishStatis&&n.onQuestionnairePublishStatis(e)}),this.socket.on("room_teachers",function(e){"function"==typeof n.onOnlineTeachers&&n.onOnlineTeachers(w(e))}),this.socket.on("external_questionnaire_publish",function(e){"function"==typeof n.onExternalQuestionnairePublish&&n.onExternalQuestionnairePublish(w(e))}),this.socket.on("ban_chat",function(e){"function"==typeof n.onBanChat&&n.onBanChat(w(e))}),this.socket.on("unban_chat",function(e){"function"==typeof n.onUnBanChat&&n.onUnBanChat(w(e))}),this.socket.on("switch_source",function(e){"function"==typeof n.onSwitchSource&&n.onSwitchSource(e)});var e=this;setTimeout(function(){try{e.socket.emit("room_user_count")}catch(e){}try{e.socket.emit("room_teachers")}catch(e){}},1500),setInterval(function(){try{e.socket.emit("room_user_count")}catch(e){}try{e.socket.emit("room_teachers")}catch(e){}},15e3)},requestInteraction:function(e,t){var i="audio";e.video&&(i+="video");var a={viewerId:n.viewerid,viewerName:n.viewername,type:i},o=void 0;try{this.socket.emit("request_speak",JSON.stringify(a))}catch(e){o=e}finally{"function"==typeof t&&t(o)}},cancelRequestInteraction:function(e,t){var n={viewerId:this.viewerid,viewerName:this.viewername,type:e};v("interaction","取消申请："+JSON.stringify(n));var i=void 0;try{this.socket.emit("cancel_request_speak",JSON.stringify(n))}catch(e){i=e}finally{"function"==typeof t&&t(i)}},hangupInteraction:function(e,t){var i={viewerId:n.viewerid,viewerName:n.viewername,type:e};v("interaction","挂断事件："+JSON.stringify(i));var a=void 0;try{this.socket.emit("hangup_interaction",JSON.stringify(i))}catch(e){a=e}finally{"function"==typeof t&&t(a)}}},o={id:"livePlayer",swfUrl:"//zeus.csslcloud.net/flash/Player.swf",isReady:!1,isPublishing:0,delay:"",foreignPublish:"",init:function(){var e={userid:n.userid,roomid:n.roomid,foreignPublish:this.foreignPublish,warmvideoid:this.warmVideoId,openhostmode:this.openHostMode,dvr:this.dvr,barrage:this.barrageData,backgroundImageUri:this.backgroundImageUri,backgroundHint:this.backgroundHint,countDownTime:n.liveCountdown,openMultiQuality:n.multiQuality,language:n.language||"",type:"liveplayer",upid:n.upid,viewerid:this.viewerid,ua:1},t=this.delay;t>0&&(e.buffer=t);swfobject.embedSWF(this.swfUrl,this.id,"100%","100%","10.0.0","/flash/expressInstall.swf",e,{allowFullscreen:"true",allowScriptAccess:"always",wmode:"transparent"})},getFlash:function(){return swfobject.getObjectById(this.id)},getPlayerTime:function(){var e=parseInt(this.getFlash()._time());return isNaN(e)||e<0?0:e},start:function(){if("isMobile"==m.isMobile()){if(n.isBan)return $("#livePlayer").css({"text-align":"center",color:"white","font-size":"18px","line-height":"232px"}),void $("#livePlayer").html("<p>直播已封禁，请联系管理员</p>");setTimeout(function(){m.init()},e)}else{if(!this.getFlash())return;this.isPublishing=1,this.getFlash()._streamStart()}},end:function(){if("isMobile"==m.isMobile())setTimeout(function(){m.end()},e);else{if(!this.getFlash())return;this.isPublishing=0,this.getFlash()._streamEnd()}},barrage:function(e){e&&this.getFlash()&&this.getFlash()._jsTOASbarrage&&this.getFlash()._jsTOASbarrage(e)},getLine:function(){var e=this.getFlash().getLine();return e&&(e=JSON.parse(e)),e},changeLine:function(e){this.getFlash().changeLine(e)},onlyAudio:function(){this.getFlash()._onlyAudio()},setSound:function(e){this.getFlash()._SetSound(e)},openSound:function(){this.getFlash()&&this.getFlash()._onSound()},closeSound:function(){this.getFlash()&&this.getFlash()._unSound()},openBarrage:function(e){this.getFlash()&&this.getFlash()._barrage(e)},showControl:function(e){this.getFlash()&&this.getFlash()._ShowControl(e)},banLive:function(){this.getFlash()&&this.getFlash()._banLive()},unbanLive:function(){this.getFlash()&&this.getFlash()._unbanLive()},showMarquee:function(e){e&&this.getFlash()&&this.getFlash()._showMarqueePlugin(e)}};window._onStart=function(){o.isReady=!0};var s={id:"drawPanel",isReady:!1,isProcessing:!1,getWidth:function(){return"100%"},getHeight:function(){return"100%"},swfUrl:"//zeus.csslcloud.net/flash/Player.swf",init:function(){m.isIPad()||m.isIPhone()||m.isAndroid()||m.isWindowsPhone()||t.fastMode||swfobject.embedSWF(this.swfUrl,this.id,this.getWidth(),this.getHeight(),"10.0.0","/flash/expressInstall.swf",{type:"drawpanel"},{allowFullscreen:"true",allowScriptAccess:"always",wmode:"transparent"},{})},getSwf:function(){if(this.isReady)return swfobject.getObjectById(this.id)},clear:function(){var e=this.getSwf();e&&(e._streamEnd(),a.pagechangedata=[],a.drawjson=[])},draw:function(e){var t=this.getSwf();t&&t.draw(e)},draws:function(e){var t=this.getSwf();t&&function(e){setTimeout(function(){t.drawList(e)})}(e)},filp:function(e){var t=this.getSwf();if(t){var i=n.documentDisplayMode;this.displayMode=1==i?"auto":2==i?"width":"auto",void 0!==f.adapt&&(this.displayMode=f.adapt?"auto":"width");var a=JSON.parse(e),o=a.url;"https:"===window.location.protocol&&(a.url=o.replace(/http:/g,"https:")),t.filp(JSON.stringify(a),this.displayMode)}},animationFilp:function(e){var t=this.getSwf();t&&t.animation(e)},barrage:function(e){e&&this.getSwf()&&this.getSwf()._jsTOASbarrage&&this.getSwf()._jsTOASbarrage(e)},showMarquee:function(e){e&&this.getSwf()&&this.getSwf().showMarqueeLight(e)}},r=[],c=[],l=[],u=!1,d=function(){$.ajax({url:"//view.csslcloud.net/api/view/info?userid="+n.userid+"&roomid="+n.roomid,type:"GET",dataType:"jsonp",success:function(e){if(e.success&&e.datas){var i=e.datas.meta;if(i&&(o.isPublishing=i.isPublishing,1==i.isPublishing)){for(var a=i.answer?i.answer:[],s=i.question?i.question:[],d=i.broadcast?i.broadcast:[],f=0;f<a.length;f++)for(var h=a[f],p=0;p<s.length;p++){(g=s[p]).encryptId==h.encryptId&&(h.questionUserId=g.questionUserId)}if(s&&s.length)for(f=0;f<s.length;f++){var g=s[f];"function"==typeof n.onQuestion&&n.onQuestion(JSON.stringify({action:"question",value:{id:g.encryptId,content:g.content,userId:g.questionUserId,userName:g.questionUserName,isPublish:g.isPublish,triggerTime:g.triggerTime,userAvatar:g.userAvatar}}))}if(a&&a.length)for(f=0;f<a.length;f++){h=a[f];"function"==typeof n.onAnswer&&n.onAnswer(JSON.stringify({action:"answer",value:{questionId:h.encryptId,isPrivate:h.isPrivate,content:h.content,userId:h.answerUserId,userName:h.answerUserName,questionUserId:h.questionUserId,triggerTime:h.triggerTime,userAvatar:h.userAvatar}}))}if(d&&d.length)for(f=0;f<d.length;f++){var v=d[f];"function"==typeof n.onBroadcastMsg&&n.onBroadcastMsg({content:v.content,time:v.time})}"isMobile"==m.isMobile()&&$.DrawingBoard&&$.DrawingBoard.history(i),t.history(i);var w=i.chatLog;if(w&&w.length){var y=[];for(f=0;f<w.length;f++){var _=w[f];y.push({userid:_.userId,username:_.userName,userrole:_.userRole,useravatar:_.userAvatar,msg:_.content,time:"",usercustommark:_.userCustomMark})}if("function"==typeof n.onPublicChatMessage)for(var b=0;b<y.length;b++)n.onPublicChatMessage(JSON.stringify(y[b]))}if(!t.fastMode){var I=i.pageChange;if(I&&I.length){I.sort(function(e,t){return parseInt(e.time)-parseInt(t.time)});var P=I.pop();c.push(JSON.stringify({fileName:P.docName,totalPage:P.docTotalPage,docid:P.encryptDocId,url:P.url,page:P.pageNum,time:P.time,useSDK:P.useSDK}))}var M=i.animation;if(M&&M.length){M.sort(function(e,t){return parseInt(e.time)-parseInt(t.time)});var S=M.pop();l.push(JSON.stringify({fileName:S.docName,totalPage:S.docTotalPage,docid:S.encryptDocId,url:S.url,page:S.pageNum,time:S.time,step:S.step}))}var k=i.draw;if(k&&k.length)for(f=0;f<k.length;f++)r.push(k[f].data)}u=!0}}}})},f=new function(e){this.interaction=new function(e){try{window.PeerConnection=window.PeerConnection||window.webkitPeerConnection00||window.webkitRTCPeerConnection||window.mozRTCPeerConnection,window.URL=window.URL||window.webkitURL||window.msURL||window.oURL,window.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,window.nativeRTCIceCandidate=window.mozRTCIceCandidate||window.RTCIceCandidate,window.nativeRTCSessionDescription=window.mozRTCSessionDescription||window.RTCSessionDescription}catch(e){}this.usersPcs={length:0},this.local={type:{video:!1,audio:!1},video:{},audio:{}},this.isRequesting=!1,this.requestInteraction=function(e,t){v("Interaction","请求互动"),this.local.type=e,this.isRequesting=!0,this.setRequestTimeoutTimer(),this.createLocalMedia(function(n){n?"function"==typeof window.on_cc_live_interaction_error&&window.on_cc_live_interaction_error(f.interaction.local.type,n,"创建音视频信息出错"):a.requestInteraction(e,t)})},this.setCallingTimer=function(){f.interaction.interactionTime=0,f.interaction.interactionTimeInterval=setInterval(function(){if(++f.interaction.interactionTime,"function"==typeof window.on_cc_live_interaction_interval){var e=f.interaction.local.type,t=f.interaction.interactionTime;window.on_cc_live_interaction_interval(e,t)}},1e3)},this.clearCallingTimer=function(){f.interaction.interactionTime=0,clearInterval(f.interaction.interactionTimeInterval)},this.setRequestTimeoutTimer=function(){f.interaction.REQUEST_INTERACTION_TIMEOUT=setTimeout(function(){f.interaction.REQUEST_INTERACTION_TIMEOUT=-1,f.interaction.hangupInteraction(n.viewerid),f.interaction.stopLocalStream(),f.interaction.isRequesting=!1,$("#interactionLocalVideo")[0].src="",$("#videoInteraction").hide(),"function"==typeof window.on_cc_live_interaction_request_timeout&&window.on_cc_live_interaction_request_timeout(f.interaction.local.type)},6e4)},this.clearRequestTimeoutTimer=function(){f.interaction.REQUEST_INTERACTION_TIMEOUT>0&&(clearTimeout(f.interaction.REQUEST_INTERACTION_TIMEOUT),f.interaction.REQUEST_INTERACTION_TIMEOUT=-1)},this.stopLocalStream=function(){if(f.interaction.local.video.stream)try{f.interaction.local.video.stream.getTracks().forEach(function(e){e.stop()})}catch(e){}if(f.interaction.local.audio.stream)try{f.interaction.local.audio.stream.getTracks().forEach(function(e){e.stop()})}catch(e){}},this.cancelInteraction=function(){f.interaction.isRequesting=!1,"function"==typeof window.on_cc_live_interaction_cancal&&window.on_cc_live_interaction_cancal(f.interaction.local.type)},this.disconnectInteraction=function(e){n.openSound(),this.clearRequestTimeoutTimer(),e==n.viewerid?$.each(f.interaction.usersPcs,function(e,t){var n=t.pc;if(null==n)return!0;if(n.close(),n=null,f.interaction.usersPcs[e]){delete f.interaction.usersPcs[e];var i=f.interaction.usersPcs.length-1;f.interaction.usersPcs.length=i<0?0:i}}):$.each(f.interaction.usersPcs,function(t,n){var i=n.pc;if(!i)return!0;if(t!=e)return!0;if(i.close(),i=null,f.interaction.usersPcs[t]){delete f.interaction.usersPcs[t];var a=f.interaction.usersPcs.length-1;f.interaction.usersPcs.length=a<0?0:a}}),0==f.interaction.usersPcs.length&&this.stopLocalStream(),f.interaction.isInteractioning=!1,f.interaction.isRequesting=!1},this.createLocalAudioAndVideoMedia=function(e){var t=this;getUserMedia.call(navigator,{video:!0,audio:!0},function(n){t.local.video.stream=n,e&&"function"==typeof e&&e(n)},function(t){v("Interaction","getUserMedia error: "+t),e&&"function"==typeof e&&e(t)})},this.createLocalAudioMedia=function(e){var t=this;getUserMedia.call(navigator,{video:!1,audio:!0},function(n){t.local.audio.stream=n,e&&"function"==typeof e&&e(n)},function(t){v("Interaction","getUserMedia error: "+t),e&&"function"==typeof e&&e(t)})},this.createLocalMedia=function(e){var t=this,n=t.local.type;getUserMedia.call(navigator,n,function(i){n.video?t.local.video.stream=i:t.local.audio.stream=i,"function"==typeof window.on_cc_live_interaction_local_media&&window.on_cc_live_interaction_local_media(n,i),e&&"function"==typeof e&&e()},function(t){v("Interaction","getUserMedia error: "+t),e&&"function"==typeof e&&e(t)})},this.iceServers={iceServers:[{url:"stun:turn.csslcloud.net:3478",credential:"bokecc",username:"cc"},{url:"turn:turn.csslcloud.net:3478",credential:"bokecc",username:"cc"}]},this.createAnswerPeerConnection=function(e){var t=new PeerConnection(this.iceServers);"audio"==e.type?(f.interaction.local.audio.stream||this.createLocalAudioMedia(),t.addStream(f.interaction.local.audio.stream)):(f.interaction.local.video.stream||this.createLocalAudioAndVideoMedia(),t.addStream(f.interaction.local.video.stream)),t.onaddstream=function(t){"function"==typeof window.on_cc_live_interaction_remote_media&&window.on_cc_live_interaction_remote_media(f.interaction.local.type,e,t.stream)},t.createAnswer(function(i){t.setLocalDescription(i),n.sendInteractionMessage(f.interaction.local.type,e.id,"answer",i)},function(e){v("Interaction","Failure callback: "+e)}),t.onicecandidate=function(t){null!==t.candidate&&n.sendInteractionMessage(f.interaction.local.type,e.id,"",t.candidate)},f.interaction.usersPcs[e.id]={pc:t,user:e},f.interaction.usersPcs.length+=1},this.createOfferPeerConnection=function(e){var t=new PeerConnection(this.iceServers),i=f.interaction.local.type;i.video?t.addStream(f.interaction.local.video.stream):t.addStream(f.interaction.local.audio.stream),t.onaddstream=function(t){"function"==typeof window.on_cc_live_interaction_remote_media&&window.on_cc_live_interaction_remote_media(f.interaction.local.type,e,t.stream)},t.oniceconnectionstatechange=function(e){v("Interaction","iceConnectionState ..."+t.iceConnectionState),"failed"==t.iceConnectionState&&(v("Interaction","iceConnectionState failed"),f.interaction.hangupInteraction(),"function"==typeof window.on_cc_live_interaction_disconnect&&window.on_cc_live_interaction_disconnect({disconnectid:n.viewerid}))},t.createOffer(function(a){t.setLocalDescription(a),n.sendInteractionMessage(i,e.id,"offer",a)},function(e){"function"==typeof window.on_cc_live_interaction_error&&window.on_cc_live_interaction_error(f.interaction.local.type,e,"createOfferPeerConnection")}),t.onicecandidate=function(t){null!==t.candidate&&n.sendInteractionMessage(i,e.id,"",t.candidate)},f.interaction.usersPcs[e.id]={pc:t,user:e},f.interaction.usersPcs.length+=1},this.id=e.interaction.id,this.isSupportInteraction=function(){return"https:"===window.location.protocol&&!!(PeerConnection&&URL&&getUserMedia&&nativeRTCIceCandidate&&nativeRTCSessionDescription)},this.hangupInteraction=function(e){this.isInteractioning?a.hangupInteraction(this.type,e):this.isRequesting?(a.cancelRequestInteraction(this.type,e),this.stopLocalStream(),this.cancelInteraction()):(this.stopLocalStream(),this.cancelInteraction())}}(e)}({interaction:{id:"interactionPlayer",width:"100%",height:"100%"}});window.on_drampanel_ready=function(){s.isReady=!0,setTimeout(function(){!function e(){if(u){if(!t.fastMode&&(r.length&&(s.draws(r),r=[]),c.length)){var n=c.pop();if(!n)return;if(s.filp(n),l.length){var i=l.pop(),a=w(i),o=w(n);o.docid==a.docid&&o.time<=a.time&&s.animationFilp(i)}c=[]}}else setTimeout(function(){e()},3e3)}()},1500)},window.on_cc_live_dw_draw=function(e){setTimeout(function(){t.draw(e)},y()),setTimeout(function(){var t=w(e);s.draw(JSON.stringify(t.value.data))},y()),"isMobile"==m.isMobile()&&setTimeout(function(){$.DrawingBoard&&$.DrawingBoard.db(e)},y())},window.on_cc_live_dw_page_change=function(e){setTimeout(function(){t.pageChange(e)},y()),setTimeout(function(){var t=w(e);s.filp(JSON.stringify(t.value))},y()),"isMobile"==m.isMobile()&&setTimeout(function(){$.DrawingBoard&&$.DrawingBoard.db(e)},y())},window.on_cc_live_dw_animation_change=function(e){setTimeout(function(){t.animationChange(e)},y()),setTimeout(function(){var t=w(e);s.animationFilp(JSON.stringify(t.value))},y()),"isMobile"==m.isMobile()&&setTimeout(function(){$.DrawingBoard&&$.DrawingBoard.db(e)},y())};var h={init:function(){a.socket.on("chat_message",function(e){"function"==typeof n.onPublicChatMessage&&n.onPublicChatMessage(e)}),a.socket.on("notification",function(e){"function"==typeof n.onNotification&&n.onNotification(e)}),a.socket.on("information",function(e){"function"==typeof n.onInformation&&n.onInformation(e)}),a.socket.on("private_chat_self",function(e){"function"==typeof n.onPrivateChatMessage&&n.onPrivateChatMessage(e)}),a.socket.on("private_chat",function(e){"function"==typeof n.onPrivateAnswer&&n.onPrivateAnswer(e)}),a.socket.on("room_context",function(e){}),a.socket.on("custom_message",function(e){"function"==typeof n.onCustomChatMessage&&n.onCustomChatMessage(e)})}},p={init:function(){a.socket.on("question",function(e){"function"==typeof n.onQuestion&&n.onQuestion(e),"function"==typeof n.onQuestionSend&&n.onQuestionSend(e)}),a.socket.on("answer",function(e){"function"==typeof n.onAnswer&&n.onAnswer(e),"function"==typeof n.onAnswerSend&&n.onAnswerSend(e)})}},g={addEvents:function(e,t,n){document.addEventListener?g.addEvents=function(e,t,n){e.addEventListener(t,n,!1)}:g.addEvents=function(e,t,n){e.attachEvent("on"+t,function(){n.call(e,arguments)})},g.addEvents(e,t,n)}},m={src:"",audio:!1,line:0,init:function(){var e=this;$.ajax({url:"//zeus.csslcloud.net/api/hls/play",type:"GET",dataType:"json",data:{roomid:n.roomid,userid:n.userid},success:function(t){if(0==t.live.status){e.m3u8=t.live.m3u8,e.src=t.live.m3u8,e.secureHosts=t.live.secureHosts||[],e.audioM3u8=t.live.audioM3u8||[],e.audioSecureHosts=t.live.audioSecureHosts||[],e.isHttps="https:"===window.location.protocol,i.init(),i.liveId=t.live.liveId,e.isHttps&&e.secureHosts&&e.secureHosts.length&&(e.m3u8=e.secureHosts),e.appendVideo(e.m3u8[0]),"function"==typeof n.onLiveStarting&&n.onLiveStarting();var a=$("#livePlayer>video")[0],o=0,s=function(){o>=3?a.removeEventListener("error",s):(a.removeEventListener("error",s),setTimeout(function(){o++,a.src=a.src,g.addEvents(a,"error",s,!1)},1e3))};g.addEvents(a,"error",s,!1)}else if(n.isBan)return $("#livePlayer").css({"text-align":"center",color:"white","font-size":"18px","line-height":"232px"}),void $("#livePlayer").html("<p>直播已封禁，请联系管理员</p>")}})},appendVideo:function(e){var t='<video id="player_live" webkit-playsinline playsinline controls autoplay x-webkit-airplay="allow" x5-playsinline width="100%" height="100%" src="'+e+'"></video>';$("#"+o.id).html(t);var a=document.getElementById("player_live");n.onKickOut=function(){$("#"+o.id).html("")},this.report=new ReportLog(i,1,11,a,!0)},ban:function(){$("#livePlayer").css({"text-align":"center",color:"white","font-size":"18px","line-height":"232px"}),$("#livePlayer").html("<p>直播已封禁，请联系管理员</p>")},unban:function(){$("#livePlayer").css({"text-align":"",color:"","font-size":"","line-height":""}),this.init()},end:function(){$("#"+o.id).html(""),this.report.stopTimer()},appendDoc:function(e){"https:"===window.location.protocol&&(e=e.replace(/http:/g,"https:"));var t='<img src="'+e+'" />';$("#"+s.id).html(t)},changeLine:function(e){$("#"+o.id).find("video").attr("src",this.m3u8[e]),this.line=e,m.audio&&(audio.src="",audio.src=this.m3u8[this.line],audio.play())},onlyAudio:function(){var e=$("#"+o.id).find("video");m.audio=!m.audio,m.audio?(this.isHttps&&this.audioSecureHosts&&this.audioSecureHosts.length?this.m3u8=this.audioSecureHosts:this.m3u8=this.audioM3u8,audio=new Audio,audio.src=this.m3u8[this.line],audio.play()):(this.isHttps&&this.secureHosts&&this.secureHosts.length?this.m3u8=this.secureHosts:this.m3u8=this.src,audio.src="",e.attr("src",this.m3u8[this.line]))},isMobile:function(){if(this.isIPad()||this.isIPhone()||this.isAndroid()||this.isWindowsPhone())return"isMobile"},isIPad:function(){return null!=navigator.userAgent.match(/iPad/i)},isIPhone:function(){return null!=navigator.userAgent.match(/iPhone/i)},isAndroid:function(){return null!=navigator.userAgent.match(/Android/i)},isWindowsPhone:function(){return null!=navigator.userAgent.match(/Windows Phone/i)}};window.on_cc_live_accept_interaction=function(e){n.closeSound(),f.interaction.clearRequestTimeoutTimer(),n.enterInteractionRoom(),f.interaction.isInteractioning=!0,f.interaction.setCallingTimer(),"function"==typeof window.on_cc_live_interaction_accept&&window.on_cc_live_interaction_accept(f.interaction.local.type,w(e))},window.on_cc_live_interaction_chatusers=function(e){e=w(e),$.each(e,function(e,t){return t.id==n.viewerid||("publisher"==t.role&&!t.isMainSpeaker||void f.interaction.createOfferPeerConnection(t))})},window.on_cc_live_interaction_message=function(e){e=w(e);v("Interaction","rtc互动信息:"+JSON.stringify(e));var t=e.toid,n=e.fromid,i=e.fromname,a=e.type,o=e.data;"string"==typeof o&&(o=JSON.parse(o));var s=e.event;if("offer"===s){if(o.type=s,f.interaction.createAnswerPeerConnection({id:n,name:i,type:a}),!(r=f.interaction.usersPcs[n].pc))return;r.setRemoteDescription(new nativeRTCSessionDescription(o)),r.createAnswer(function(){},function(e){v("Interaction","Failure callback: "+e)})}else if("answer"===s){if(!(r=f.interaction.usersPcs[n].pc))return;o.type=s,v("Interaction","answer spark_message信息:"+o),r.setRemoteDescription(new nativeRTCSessionDescription(o)),r.receivedAnswer=!0,!r.hasAddIce&&r.RTCICE&&r.addIceCandidate(r.RTCICE)}else{var r,c=f.interaction.usersPcs[n];if(c||(c=f.interaction.usersPcs[t]),!(r=c?c.pc:null))return;var l=new RTCIceCandidate(o);r.receivedAnswer?(r.hasAddIce=!0,r.addIceCandidate(l)):(r.hasAddIce=!1,r.RTCICE=l)}};var v=function(e,t){};function w(e){if("string"==typeof e)try{return JSON.parse(e)}catch(e){return{}}return e}function y(){var e=o.delay;return(isNaN(e)||e<0)&&(e=0),e*=1e3,"isMobile"==m.isMobile()?0===e?5e3:1e4:0===e?1300:3e3}window.DWLive=n,window.live=f,window._swfInit=function(){"function"==typeof window.on_cc_live_player_ready&&window.on_cc_live_player_ready()},window._swfOk=function(e){"function"==typeof window.on_cc_swf_loading_completed&&window.on_cc_swf_loading_completed(e)}}(window)},function(e,t){!function(e,t,n){var i=function(e){var i="https:"===t.location.protocol,a=e.chat.host;if(i&&a&&a.indexOf(":")){var o=a.split(":");if(2==o.length){var s=parseInt(o[1]);if(!isNaN(s)){var r=s+400;a=o[0]+":"+r}}}var c=0;"isMobile"==g.isMobile()&&(c=1);io.connect(n.location.protocol+"//"+a+"/replay",{query:{roomid:e.roomId,sessionid:e.viewer.sessionId,platform:1,terminal:c}})},a=function(t){e.ajax({url:t.url,type:"GET",data:t.data,tryCount:0,retryLimit:3,timeout:5e3,dataType:"jsonp",success:function(e){t.done(e)},error:function(n,i,a){if("timeout"==i)return this.tryCount++,this.tryCount<this.retryLimit?void e.ajax(this):void("function"==typeof t.fn&&t.fn(i));n.status}})},o=function(o,s){!function(e,n){var i={roomid:e.roomId,userid:e.userId,liveid:e.liveId,upid:e.upId,recordid:e.recordId,viewertoken:e.viewertoken,viewername:e.viewername,forcibly:e.forcibly},o={globalData:{},requestLoginData:!1,requestInfoData:!1,requestDrawData:!1,requestChatqaData:!1,allRequests:0};a({url:"//view.csslcloud.net/api/room/replay/login",data:i,fn:t.on_cc_login_error,done:function(e){if(!s(e,t.on_cc_login_error))return!1;r(o.globalData,e),o.requestLoginData=!0,o.requestInfoData=!1,o.requestDrawData=!1,o.requestChatqaData=!1,o.allRequests++,l(o),a({url:"//view.csslcloud.net/api/view/replay/draw/info",data:i,fn:t.on_cc_request_draw_error,done:function(e){if(!s(e,t.on_cc_request_draw_error))return!1;r(o.globalData,e),o.requestLoginData=!1,o.requestInfoData=!1,o.requestDrawData=!0,o.requestChatqaData=!1,o.allRequests++,l(o)}}),a({url:"//view.csslcloud.net/api/view/replay/chatqa/info",data:i,fn:t.on_cc_request_chatqa_error,done:function(e){if(!s(e,t.on_cc_request_chatqa_error))return!1;r(o.globalData,e),o.requestLoginData=!1,o.requestInfoData=!1,o.requestDrawData=!1,o.requestChatqaData=!0,o.allRequests++,l(o)}}),a({url:"//view.csslcloud.net/api/view/replay/info",data:i,fn:t.on_cc_request_info_error,done:function(e){if(!s(e,t.on_cc_request_info_error))return!1;r(o.globalData,e),o.requestLoginData=!1,o.requestInfoData=!0,o.requestDrawData=!1,o.requestChatqaData=!1,o.allRequests++,l(o)}})}});var s=function(e,t){return e.success?!!e.datas:("function"==typeof t&&t(e),!1)},r=function(e,t){c(e,t),e.datas.meta||(e.datas.meta={}),c(e.datas.meta,t.datas.meta)},c=function(e,t){for(var n in t)t.hasOwnProperty(n)&&!e.hasOwnProperty(n)&&(e[n]=t[n])},l=function(e){n(e)}}(o,function(a){var c=a.globalData;a.requestLoginData&&(l.fastMode&&(e("#documentDisplayMode").val(c.datas.room.documentDisplayMode),l.appendDrawPanel(),l.init()),o.chat={host:c.datas.pusherNode.primary},o.viewer.sessionId=c.datas.sessionId,o.liveId=c.datas.encryptLiveId,o.upId=c.datas.upId,o.viewerId=c.datas.viewer.id,s.socket=new i(o),"function"==typeof t.on_cc_callback_player&&t.on_cc_callback_player(c.datas.live.encryptRecordvideoId),u.isH5play?g.init(o):"isMobile"==g.isMobile()&&g.init(o));var p=c.datas.meta;if(!p)return;if(a.requestInfoData){for(var m=p.pageChange,v=0;v<m.length;v++){var w=m[v].url,y="https:"===t.location.protocol;w.indexOf("//")>0&&y&&(w=w.replace("http:","https:"),m[v].url=w)}"function"==typeof t.on_cc_callback_pages&&t.on_cc_callback_pages(m);var _=p.pageChange;_&&_.length&&(_.sort(function(e,t){return parseInt(e.time)-parseInt(t.time)}),s.pageChanges=_);var b=p.animation;b&&b.length&&(b.sort(function(e,t){return parseInt(e.time)-parseInt(t.time)}),s.animations=b);var I=p.broadcast;if(t.chatLogs=p.broadcast,I&&I.length){I.sort(function(e,t){return parseInt(e.time)-parseInt(t.time)});for(var v=0;v<I.length;v++){var P=I[v];"function"==typeof t.on_cc_live_broadcast_msg&&t.on_cc_live_broadcast_msg({content:P.content,time:P.time})}s.broadcasts=I}}if(a.requestChatqaData){var M=p.question;if(M&&M.length){M.sort(function(e,t){return parseInt(e.time)-parseInt(t.time)}),s.questions=M;for(var v=0;v<s.questions.length;v++){var S=M[v];"function"==typeof t.on_cc_live_qa_question&&t.on_cc_live_qa_question({action:"question",value:{id:S.encryptId,content:S.content,userId:S.questionUserId,userName:S.questionUserName,userAvatar:S.questionUserAvatar,isPublish:S.isPublish}})}}var k=p.answer;if(k&&k.length){k.sort(function(e,t){return parseInt(e.time)-parseInt(t.time)}),s.answers=k;for(var v=0;v<s.answers.length;v++){var T=k[v];"function"==typeof t.on_cc_live_qa_answer&&t.on_cc_live_qa_answer({action:"answer",value:{questionId:T.encryptId,content:T.content,userId:T.answerUserId,isPrivate:T.isPrivate,userName:T.answerUserName,userAvatar:T.answerUserAvatar,userRole:T.answerUserRole}})}}var C=p.chatLog;if(t.chatLogs=p.chatLog,C&&C.length){C.sort(function(e,t){return parseInt(e.time)-parseInt(t.time)});for(var v=0;v<C.length;v++){var D=C[v];"function"==typeof t.on_cc_live_chat_msg&&t.on_cc_live_chat_msg({userid:D.userId,username:D.userName,time:D.time,msg:D.content,useravatar:D.userAvatar,userRole:D.userRole,usercustommark:D.userCustomMark})}s.chatLogs=C}t.chatLogs&&t.chatLogs.length&&(t.CHATLOGS=t.chatLogs,f()),t.broadcasts&&t.broadcasts.length&&(t.BROADCASTS=t.broadcasts,h())}if(a.requestDrawData){var N=p.draw;N&&N.length&&(s.draws=N),s.isHistoryReady=!0,s.drawPanel.isReady=!0,setTimeout(function(){d()},1500)}t.on_cc_h5_player_load=function(){if(s.callbackPlayer.isReady=!0,!r){r=!0;var t=n.getElementById("drawPanel");t&&e.Callback.config({playerId:"playbackVideo"},p)}}});var r=!1},s=function(e){this.chatLogs=[],this.broadcasts=[],this.draws=[],this.pageChanges=[],this.isHistoryReady=!1,this.questions=[],this.answers=[],this.pageChanges=[],this.draws=[],this.animations=[],this.pageChangeIndex=-1,this.drawIndex=-1,this.animationIndex=-1,this.drawPanel=new function(e,n){this.isReady=!1;l.fastMode||swfobject.embedSWF("//zeus.csslcloud.net/flash/Player.swf",e.drawPanel.id,e.drawPanel.width,e.drawPanel.height,"10.0.0","/flash/expressInstall.swf",{type:"drawpanel"},{allowFullscreen:"true",allowScriptAccess:"always",wmode:"transparent"},{}),this.getFlash=function(){if(this.isReady)return swfobject.getObjectById(e.drawPanel.id)},this.clear=function(){l.clear();var e=this.getFlash();e&&e.clear()},this.draw=function(e){l.draw(e);var t=this.getFlash();t&&t.draw(e)},this.draws=function(e){var t=this.getFlash();t&&function(e){setTimeout(function(){t.drawList(e)})}(e)},this.filp=function(e){l.pageChange(e);var n=this.getFlash();if(n){var i=JSON.parse(e),a=i.url;"https:"===t.location.protocol&&(i.url=a.replace(/http:/g,"https:")),c.adapt?n.filp(JSON.stringify(i),"auto"):n.filp(JSON.stringify(i))}},this.animation=function(e){l.animationChange(e);var t=this.getFlash();t&&t.animation(e)},this.intervalNum=0,this.interval=function(){var e=0;try{e=r.callbackPlayer.getPlayerTime()}catch(e){}if(!(e<0)){try{if(r.animations&&r.animations.length>0&&r.animationIndex<r.animations.length&&(o=r.pageChangeIndex)>=0){var n=r.pageChanges[o],i=r.animations[r.animationIndex+1];n&&i&&n.encryptDocId==i.encryptDocId&&e>=i.time&&n.time<=i.time&&(l.fastMode?this.animation(i):this.animation(JSON.stringify({fileName:i.docName,totalPage:i.docTotalPage,docid:i.encryptDocId,url:i.url,page:i.pageNum,step:i.step})),r.animationIndex=r.animationIndex+1)}}catch(e){}try{if(r.pageChanges&&r.pageChanges.length>0&&r.pageChangeIndex<r.pageChanges.length&&e>=(n=r.pageChanges[r.pageChangeIndex+1]).time){"function"==typeof t.on_cc_callback_page_change&&t.on_cc_callback_page_change(n),l.fastMode?this.filp(n):this.filp(JSON.stringify({fileName:n.docName,totalPage:n.docTotalPage,docid:n.encryptDocId,url:n.url,page:n.pageNum,useSDK:n.useSDK})),r.pageChangeIndex=r.pageChangeIndex+1;var a={};a.docId=n.docId,a.docName=n.docName,a.docTotalPage=n.docTotalPage,a.pageNum=n.pageNum,"function"==typeof t.on_cc_callback_pagechange&&t.on_cc_callback_pagechange(a)}}catch(e){}try{var o;r.animations&&r.animations.length>0&&r.animationIndex<r.animations.length&&(o=r.pageChangeIndex)>=0&&(n=r.pageChanges[o],i=r.animations[r.animationIndex+1],n&&i&&n.encryptDocId==i.encryptDocId&&e>=i.time&&n.time<=i.time&&(l.fastMode?this.animation(i):this.animation(JSON.stringify({fileName:i.docName,totalPage:i.docTotalPage,docid:i.encryptDocId,url:i.url,page:i.pageNum,step:i.step})),r.animationIndex=r.animationIndex+1))}catch(e){}try{if(r.draws&&r.draws.length>0&&r.drawIndex<r.draws.length)for(var s=r.draws[r.drawIndex+1];e>=s.time;)l.fastMode?this.draw(s):this.draw(s.data),r.drawIndex=r.drawIndex+1,s=r.draws[r.drawIndex+1]}catch(e){}}},this.intervalPainting=function(e){e.drawPanel.intervalNum=setInterval(function(){e.drawPanel.interval(e)},1e3)}}(e,this),this.history=new o(e,this),this.chatMessageCache=new function(){this.cache=[],this.lastTimeRefresh=(new Date).getTime(),this.INTERVAL_TIME=setInterval(function(){r.chatMessageCache.refresh()},80),this.push=function(e){this.cache.length>5e3||this.cache.push(e)},this.ableRefresh=function(){var e=(new Date).getTime();return 0!=this.cache.length&&e-this.lastTimeRefresh>=80},this.refresh=function(){if(this.ableRefresh()){clearInterval(this.INTERVAL_TIME);for(var e=[],n=Math.min(this.cache.length,10),i=0;i<n;i++)e.push(this.cache.shift());"function"==typeof t.on_cc_live_chat_msg_sync&&t.on_cc_live_chat_msg_sync(e),this.lastTimeRefresh=(new Date).getTime(),this.INTERVAL_TIME=setInterval(function(){r.chatMessageCache.refresh()},80)}}},this.broadcastCache=new function(){this.cache=[],this.lastTimeRefresh=(new Date).getTime(),this.INTERVAL_TIME=setInterval(function(){r.broadcastCache.refresh()},80),this.push=function(e){this.cache.length>5e3||this.cache.push(e)},this.ableRefresh=function(){var e=(new Date).getTime();return 0!=this.cache.length&&e-this.lastTimeRefresh>=80},this.refresh=function(){if(this.ableRefresh()){clearInterval(this.INTERVAL_TIME);for(var e=[],n=Math.min(this.cache.length,10),i=0;i<n;i++)e.push(this.cache.shift());"function"==typeof t.on_cc_live_broadcast_msg_sync&&t.on_cc_live_broadcast_msg_sync(e),this.lastTimeRefresh=(new Date).getTime(),this.INTERVAL_TIME=setInterval(function(){r.broadcastCache.refresh()},80)}}}},r={},c={userId:e("#userId").val(),roomId:e("#roomId").val(),liveId:e("#liveId").val(),recordId:e("#recordId").val(),videoId:e("#videoId").val(),adapt:!1,isShowBar:0,viewerId:e("#viewerId").val(),upId:e("#upId").val(),viewer:{id:e("#viewerId").val(),name:e("#viewerName").val(),role:e("#viewerRole").val(),sessionId:e("#sessionId").val()},callbackPlayer:{id:"playbackPlayer",width:"100%",height:"100%"},drawPanel:{id:"playbackPanel",width:"100%",height:"100%"}},l={dpc:{},fastMode:!1,init:function(){this.dpc=new Dpc},appendDrawPanel:function(){var n='<iframe id="dpa" allow-scripts allowfullscreen allowusermedia frameborder="0" style="width: 100%;height:100%;"></iframe>';"isMobile"==g.isMobile()&&(n='<iframe id="dpa" allow-scripts allowfullscreen allowusermedia frameborder="0" style="width: 100%;height:100%;pointer-events: none;"></iframe>'),e("#playbackPanel").parent().append(n),e("div#playbackPanel").remove(),"function"==typeof t.on_cc_live_db_flip&&t.on_cc_live_db_flip()},pageChange:function(e){this.fastMode&&this.dpc.pageChange(e)},animationChange:function(e){this.fastMode&&this.dpc.animationChange(e)},history:function(e){this.fastMode&&this.dpc.history(e)},draw:function(e){this.fastMode&&this.dpc.draw(e)},clear:function(){this.fastMode&&this.dpc.clear()}};var u={isH5play:!1,fastMode:!1,setFastMode:function(e){"string"==typeof e.fastMode?"false"===e.fastMode?this.fastMode=!1:this.fastMode=!0:"boolean"==typeof e.fastMode?this.fastMode=e.fastMode:this.fastMode=!1},config:function(t){(function(){if(n.createElement("video").canPlayType){var e=n.createElement("video");return oggTest=e.canPlayType('video/ogg; codecs="theora, vorbis"'),oggTest?"probably"==oggTest:(h264Test=e.canPlayType('video/mp4; codecs="avc1.42E01E, mp4a.40.2"'),!!h264Test&&"probably"==h264Test)}return!1})()&&(this.isH5play=t.isH5play),this.setFastMode(t),l.fastMode=this.fastMode;var i=["//static.csslcloud.net/js/socket.io.js","//static.csslcloud.net/js/swfobject.js","//static.csslcloud.net/js/json3.min.js","//static.csslcloud.net/js/module/drawingBoard-2.0.0.js","//static.csslcloud.net/js/module/drawingBoardPlayback.js","//static.csslcloud.net/js/report.js"];l.fastMode&&i.splice(3,2),this.loadScript(i,function(){!function(t){c.viewerId=t.viewerid,c=e.extend(c,t),r=new s(c)}(t),"isMobile"==g.isMobile()&&e.DrawingBoard&&!l.fastMode&&u.appendDrawPanel()})},appendDrawPanel:function(){e("#playbackPanel").parent().append('<canvas id="drawPanel" width="1200" height="1200" style="position: absolute;z-index:2;top:0;left: 0"></canvas><iframe id="dpa" src="" frameborder="0" style="position: absolute;top:0;left: 0"></iframe>'),e("div#playbackPanel").remove()},logout:function(){e.ajax({url:"//view.csslcloud.net/api/callback/logout",type:"GET",dataType:"json",timeout:5e3,xhrFields:{withCredentials:!0},success:function(e){},error:function(e,t,n){}})},getScript:function(e,t){var i=!1,a=n.createElement("script");a.src=e,a.onload=a.onreadystatechange=function(){i||this.readyState&&"loaded"!=this.readyState&&"complete"!=this.readyState||(i=!0,t&&t())},n.body.appendChild(a)},loadScript:function(e,t){if("string"==typeof e){var n=e;(e=[]).push(n)}var i=this,a=function(e,t){i.getScript(e.shift(),function(){e.length?a(e,t):t&&t()})};a(e,t)},playbackRate:function(e){r.callbackPlayer.playbackRate(e)},seek:function(e){clearInterval(r.drawPanel.intervalNum),r.callbackPlayer.seek(e)},getPlayerTime:function(){return r.callbackPlayer.getPlayerTime()},getDuration:function(){return u.isH5play?g.getDuration():"isMobile"==g.isMobile()?g.getDuration():r.callbackPlayer.getDuration()},docAdapt:function(e){c.adapt=e},isShowBar:function(e){c.isShowBar=e},getBuffer:function(){return r.callbackPlayer.getBuffer()},setVolume:function(e){return r.callbackPlayer.setVolume(e)},getVolume:function(){return r.callbackPlayer.getVolume()},play:function(){return r.callbackPlayer.play()},setZScale:function(e){return r.callbackPlayer.setZScale(e)},getZScale:function(){return r.callbackPlayer.getZScale()},setScale:function(e){return r.callbackPlayer.setScale(e)},getScale:function(){return r.callbackPlayer.getScale()},openSettingPanel:function(){return r.callbackPlayer.openSettingPanel()}};function d(){r.isHistoryReady?function e(){r.callbackPlayer.isReady?r.drawPanel.intervalPainting(r):setTimeout(function(){e()},500)}():setTimeout(function(){d()},300)}function f(){setInterval(function(){var n=0;try{n=parseInt(e("#playbackVideo")[0].currentTime,10)}catch(e){}if(!(n<=0)&&t.CHATLOGS.length)for(var i=t.CHATLOGS[0];i.time<=n;){var a=t.CHATLOGS.shift();if(r.chatMessageCache.push({userid:a.userId,username:a.userName,time:a.time,msg:a.content,useravatar:a.userAvatar,userRole:a.userRole,usercustommark:a.userCustomMark}),!t.CHATLOGS.length)break;i=t.CHATLOGS[0]}},1e3)}function h(){setInterval(function(){var n=0;try{n=parseInt(e("#playbackVideo")[0].currentTime,10)}catch(e){}if(!(n<=0)&&t.BROADCASTS.length)for(var i=t.BROADCASTS[0];i.time<=n;){var a=t.BROADCASTS.shift();if(r.broadcastCache.push({content:a.content,time:a.time}),!t.BROADCASTS.length)break;i=t.BROADCASTS[0]}},1e3)}e.extend({DW:u}),t.on_cc_callback_player=function(t){c.videoId=t,r.callbackPlayer=new function(t){this.isReady=!1,this.isPublishing=0,this.id=t.callbackPlayer.id;var n={userid:t.userId,videoid:t.videoId,recordid:t.recordId,isShowBar:t.isShowBar,upid:t.upId,viewerid:t.viewerId,roomid:t.roomId,ua:"1"},i={allowFullscreen:"true",allowScriptAccess:"always",wmode:"transparent"};this.flashPlayerInit=function(){swfobject.embedSWF("//player.csslcloud.net/platform/live/CallbackPlayer.swf",t.callbackPlayer.id,t.callbackPlayer.width,t.callbackPlayer.height,"10.0.0","/flash/expressInstall.swf",n,i),"isMobile"!=g.isMobile()&&new ReportLog(t,0,1,null,!1)},u.isH5play||this.flashPlayerInit(),this.getFlash=function(){return swfobject.getObjectById(this.id)},this.playbackRate=function(e){(u.isH5play||"isMobile"===g.isMobile())&&(e=parseFloat(e),this.getH5player().playbackRate=e)},this.seek=function(e){if(!(e<0))if(u.isH5play||"isMobile"==g.isMobile())this.getH5player().currentTime=e;else{var t=this.getFlash();if(!t)return;t.seek(e)}},this.getFlash=function(){return swfobject.getObjectById(this.id)},this.getH5player=function(){return e("#playbackVideo")[0]},this.getPlayerTime=function(){return this.isReady?(e=u.isH5play||"isMobile"==g.isMobile()?this.getH5player().currentTime:parseInt(this.getFlash().getPosition(),10),isNaN(e)||e<0?0:e):0;var e},this.getDuration=function(){if(u.isH5play||"isMobile"==g.isMobile())return this.getH5player().duration;var e=this.getFlash();return e?e.getDuration():void 0},this.getBuffer=function(){if(u.isH5play||"isMobile"==g.isMobile())return this.getH5player().buffered.end(0);var e=this.getFlash();return e?e.getBufferLength():void 0},this.setVolume=function(e){if(!u.isH5play&&"isMobile"!=g.isMobile()){var t=this.getFlash();if(!t)return;return t.setVolume(e)}this.getH5player().volume=parseFloat(e)},this.getVolume=function(){if(u.isH5play||"isMobile"==g.isMobile())return this.getH5player().volume;var e=this.getFlash();return e?e.getVolume():void 0},this.play=function(){if(!u.isH5play&&"isMobile"!=g.isMobile()){var e=this.getFlash();if(!e)return;return e.isPlay()}g.pauseState?this.getH5player().play():this.getH5player().pause()},this.setZScale=function(e){var t=this.getFlash();if(t)return t.setZScale(e)},this.getZScale=function(){var e=this.getFlash();if(e)return e.getZScale()},this.setScale=function(e){var t=this.getFlash();if(t)return t.setScale(e)},this.getScale=function(){var e=this.getFlash();if(e)return e.getScale()},this.openSettingPanel=function(){var e=this.getFlash();if(e)return e.openSettingPanel()}}(c)},t.on_cc_live_player_init=function(){r.callbackPlayer.isReady=!0;try{r.callbackPlayer.getFlash().start()}catch(e){}setInterval(function(){var e=0;try{e=r.callbackPlayer.getPlayerTime()}catch(e){}if(!(e<=0)&&r.chatLogs.length)for(var t=r.chatLogs[0];t.time<=e&&(t=r.chatLogs.shift(),r.chatMessageCache.push({userid:t.userId,username:t.userName,time:t.time,msg:t.content,useravatar:t.userAvatar,userRole:t.userRole,usercustommark:t.userCustomMark}),r.chatLogs.length);)t=r.chatLogs[0]},1e3),setInterval(function(){var e=0;try{e=r.callbackPlayer.getPlayerTime()}catch(e){}if(!(e<=0)&&r.broadcasts.length)for(var t=r.broadcasts[0];t.time<=e&&(t=r.broadcasts.shift(),r.broadcastCache.push({content:t.content,time:t.time}),r.broadcasts.length);)t=r.broadcasts[0]},1e3),"function"==typeof t.on_cc_live_player_load&&t.on_cc_live_player_load()},t.seekStart=function(){clearInterval(r.drawPanel.intervalNum)},t.seekComplete=function(){r.drawPanel.clear();var e=r.callbackPlayer.getPlayerTime();e<0&&(e=0),r.pageChangeIndex=-1,r.drawIndex=-1,r.animationIndex=-1;var n={pageChange:[],animation:[],draw:[]};if(r.pageChanges&&r.pageChanges.length>0){for(var i=0;i<r.pageChanges.length;i++){e>=(a=r.pageChanges[i]).time&&(r.pageChangeIndex=i)}if(r.pageChangeIndex>=0){var a=r.pageChanges[r.pageChangeIndex];"function"==typeof t.on_cc_callback_page_change&&t.on_cc_callback_page_change(a),r.drawPanel.filp(JSON.stringify({fileName:a.docName,totalPage:a.docTotalPage,docid:a.encryptDocId,url:a.url,page:a.pageNum,useSDK:a.useSDK})),n.pageChange.push(a)}}if(r.animations&&r.animations.length>0){for(i=0;i<r.animations.length;i++){e>=(s=r.animations[i]).time&&(r.animationIndex=i)}if(r.animationIndex>=0){var o=r.pageChangeIndex;if(o>=0){a=r.pageChanges[o];var s=r.animations[r.animationIndex];a&&s&&a.encryptDocId==s.encryptDocId&&e>=s.time&&a.time<=s.time&&(r.drawPanel.animation(JSON.stringify({fileName:s.docName,totalPage:s.docTotalPage,docid:s.encryptDocId,url:s.url,page:s.pageNum,step:s.step})),n.animation.push(s))}}}if(r.draws&&r.draws.length>0){for(i=0;i<r.draws.length;i++){e>=(d=r.draws[i]).time&&(r.drawIndex=i)}var c=r.draws.slice(0,r.drawIndex+1);if(c.length>0){var u=[];for(i=0;i<c.length;i++){var d=c[i];u.push(d.data),n.draw.push(d)}r.drawPanel.draws(u)}}l.history(n),r.drawPanel.intervalNum=setInterval(function(){r.drawPanel.interval()},1e3)};var p={};p.addEvents=function(e,t,i){n.addEventListener?p.addEvents=function(e,t,n){e.addEventListener(t,n,!1)}:p.addEvents=function(e,t,n){e.attachEvent("on"+t,function(){n.call(e,arguments)})},p.addEvents(e,t,i)};var g={pauseState:!1,init:function(n){var i=this;e.ajax({url:"//view.csslcloud.net/api/vod/play/mobile",type:"GET",dataType:"jsonp",data:{userid:n.userId,videoid:n.videoId},success:function(e){var a=e.video[0],o=a.playurl,s=a.secureplayurl;"https:"===t.location.protocol&&s&&(o=s),i.appendVideo(o,n)}})},appendVideo:function(i,a){var o=this,s='<video id="playbackVideo" webkit-playsinline playsinline controls autoplay x-webkit-airplay="deny" x5-playsinline width="100%" height="100%" src="'+i+'"></video>';e("#"+playbackPlayer.id).html(s);var r=n.getElementById("playbackVideo");a.isShowBar&&r.removeAttribute("controls");var c=0,l=1;"isMobile"==g.isMobile()&&(c=1,l=11);new ReportLog(a,c,l,r,!1);this.isAndroid()||(this.pauseState=!0),p.addEvents(r,"canplay",function(){"isMobile"==g.isMobile()?(t.on_cc_live_player_load&&t.on_cc_live_player_load(),t.on_cc_h5_player_load&&t.on_cc_h5_player_load()):u.isH5play&&t.on_cc_live_player_init&&t.on_cc_live_player_init()},!1),p.addEvents(r,"playing",function(){o.pauseState=!1,t.on_player_start&&on_player_start(),t.on_spark_player_resume&&on_spark_player_resume()},!1),p.addEvents(r,"pause",function(){o.pauseState=!0,t.on_spark_player_pause&&on_spark_player_pause()},!1),p.addEvents(r,"ended",function(){t.on_spark_player_end&&on_spark_player_end()},!1),p.addEvents(r,"seeking",function(){seekStart&&seekStart()},!1),p.addEvents(r,"seeked",function(){seekComplete&&seekComplete()},!1)},getDuration:function(){var e=n.getElementById("playbackVideo");if(e)return Math.floor(e.duration)},getPlayerTime:function(){var e=n.getElementById("playbackVideo");if(e)return Math.floor(e.currentTime)},end:function(){e("#"+playbackPlayer.id).html("end")},appendDoc:function(t){var n='<img src="'+t+'" />';e("#"+playbackPanel.id).append(n)},isMobile:function(){if(this.isIPad()||this.isIPhone()||this.isAndroid()||this.isWindowsPhone())return"isMobile"},isIPad:function(){return null!=navigator.userAgent.match(/iPad/i)},isIPhone:function(){return null!=navigator.userAgent.match(/iPhone/i)},isAndroid:function(){return null!=navigator.userAgent.match(/Android/i)},isWindowsPhone:function(){return null!=navigator.userAgent.match(/Windows Phone/i)}}}(jQuery,window,document)}]);
//# sourceMappingURL=bundle.js.map