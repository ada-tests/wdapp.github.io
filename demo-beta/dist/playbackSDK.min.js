!function(e){var t={};function a(i){if(t[i])return t[i].exports;var s=t[i]={i:i,l:!1,exports:{}};return e[i].call(s.exports,s,s.exports,a),s.l=!0,s.exports}a.m=e,a.c=t,a.d=function(e,t,i){a.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:i})},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="",a(a.s=0)}([function(e,t,a){e.exports=a(1)},function(e,t){!function(e,t,a){var i=function(e){var i="https:"===t.location.protocol,s=e.chat.host;if(i&&s&&s.indexOf(":")){var n=s.split(":");if(2==n.length){var r=parseInt(n[1]);if(!isNaN(r)){var o=r+400;s=n[0]+":"+o}}}var l=0;"isMobile"==I.isMobile()&&(l=1);io.connect(a.location.protocol+"//"+s+"/replay",{query:{roomid:e.roomId,sessionid:e.viewer.sessionId,platform:1,terminal:l}})},s=function(t){e.ajax({url:t.url,type:"GET",data:t.data,tryCount:0,retryLimit:3,timeout:5e3,dataType:"jsonp",success:function(e){t.done(e)},error:function(a,i,s){if("timeout"==i)return this.tryCount++,this.tryCount<this.retryLimit?void e.ajax(this):void("function"==typeof t.fn&&t.fn(i));a.status}})},n=function(e,a){var i={roomid:e.roomId,userid:e.userId,liveid:e.liveId,upid:e.upId,recordid:e.recordId,viewertoken:e.viewertoken,viewername:e.viewername,forcibly:e.forcibly},n={globalData:{},requestLoginData:!1,requestInfoData:!1,requestDrawData:!1,requestChatqaData:!1,allRequests:0};s({url:"//view.csslcloud.net/api/room/replay/login",data:i,fn:t.on_cc_login_error,done:function(e){if(!l(e,t.on_cc_login_error))return!1;if(e.success){d.drawRequestTime=parseInt(e.datas.drawRequestTime)||1,t.TIMEOUT=t.TIMEOUT+1e3*d.drawRequestTime,h.fastMode||(d.drawRequestTime=""),u.log("options",d),c.state=new r;var a=new r;c.drawsInfoRequestPool=new o(c.state,a)}f(n.globalData,e),n.requestLoginData=!0,n.requestInfoData=!1,n.requestDrawData=!1,n.requestChatqaData=!1,n.allRequests++,g(n),d.drawRequestTime||s({url:"//view.csslcloud.net/api/view/replay/draw/info",data:i,fn:t.on_cc_request_draw_error,done:function(e){if(!l(e))return!1;f(n.globalData,e),n.requestLoginData=!1,n.requestInfoData=!1,n.requestDrawData=!0,n.requestChatqaData=!1,n.allRequests++,g(n)}}),s({url:"//view.csslcloud.net/api/view/replay/v2/chatqa/info",data:i,fn:t.on_cc_request_chatqa_error,done:function(e){if(!l(e,t.on_cc_request_chatqa_error))return!1;f(n.globalData,e),n.requestLoginData=!1,n.requestInfoData=!1,n.requestDrawData=!1,n.requestChatqaData=!0,n.allRequests++,g(n)}}),s({url:"//view.csslcloud.net/api/view/replay/v2/info",data:i,fn:t.on_cc_request_info_error,done:function(e){if(!l(e,t.on_cc_request_info_error))return!1;f(n.globalData,e),n.requestLoginData=!1,n.requestInfoData=!0,n.requestDrawData=!1,n.requestChatqaData=!1,n.allRequests++,g(n)}})}});var l=function(e,t){return e.success?!!e.datas:("function"==typeof t&&t(e),!1)},f=function(e,t){p(e,t),e.datas.meta||(e.datas.meta={}),p(e.datas.meta,t.datas.meta)},p=function(e,t){for(var a in t)t.hasOwnProperty(a)&&!e.hasOwnProperty(a)&&(e[a]=t[a])},g=function(e){a(e)}},r=function(){this.requestState=!1,this.result=0,this.startTime=0,this.endTime=0,this.key=0,this.index=0,this.ajax={},this.states=[],this.snapshoot=[],this.drawsAlready=0,this.roomId=d.roomId,this.userId=d.userId,this.recordId=d.recordId,this.liveId=d.liveId,this.drawRequestTime=d.drawRequestTime,this.setSnapshoot=function(e,t){this.snapshoot[e]=t},this.getSnapshoot=function(){return this.snapshoot},this.init=function(e){for(var t=0;t<this.drawRequestTime;t++){var a={requestState:!1,result:0,startTime:e.startTime,endTime:e.endTime,key:t};e.startTime=e.startTime+e.blockTime,e.endTime=e.startTime+e.blockTime,this.setState(a)}},this.httpRequest=function(a,i){var s=this;s.requestState=!0,this.ajax=e.ajax({url:a.url,type:"GET",data:a.param,tryCount:0,retryLimit:3,timeout:t.TIMEOUT,dataType:"jsonp",success:function(e){s.result=e,e.success?(i(e),s.requestState=!1):u.log("data.success",e.success)},error:function(t,a,i){if("timeout"==a)return this.tryCount++,this.tryCount<this.retryLimit?(e.ajax(this),void u.log("ajax["+s.key+"] try again tryCount",this.tryCount)):(u.log("数据请求失败且重试多次"),void(s.requestState=!1));t.status}})},this.abort=function(){this.ajax.abort(),this.requestState=!1},this.setState=function(e){if("object"==typeof e){var t=e.key||this.index++;e.key&&!isNaN(e.key)&&(this.index=parseInt(e.key)+1);var a=new r;a.requestState=e.requestState||this.requestState,a.result=e.result||this.result,a.startTime=e.startTime||this.startTime,a.endTime=e.endTime||this.endTime,a.ajax=e.ajax||this.ajax,a.snapshoot=e.snapshoot||this.snapshoot,a.key=t,this.states[t]=a}},this.getState=function(e){return this.states[e]},this.getStates=function(){return this.states},this.getCurrentStateIndex=function(e){for(var t=0,a=0;a<this.states.length;a++)if(e>this.states[a].startTime&&e<=this.states[a].endTime){t=a;break}return t},this.isDrawsAlready=function(){return parseInt(this.drawRequestTime,10)===parseInt(this.drawsAlready,10)}},o=function(e,t){function a(e,t){var a=e.concat(t),i=[],s={};for(var n in a)s[JSON.stringify(a[n])]||(i.push(a[n]),s[JSON.stringify(a[n])]=1);return i}this.state=e,this.requestNumber=2,this.httpRequestPool=[],this.draws=[],this.preState={},this.isHttpRequestCurrentDraws=function(t,a){if(e.drawRequestTime){var i=e.isDrawsAlready();if(i)u.log("画笔数据加载完毕，不在预加载某一段数据");else{var s=e.getStates(),n=e.getCurrentStateIndex(t),r=s[n];if(this.preState!=r&&this.preState.requestState&&(u.log("发现新的预加载请求，中断上一个预加载请求;index="+this.preState.key),this.preState.abort()),this.preState=r,i||r.result||r.requestState)u.log("预加载过这段数据或已有数据;index="+n);else{u.log("预加载数据",n);var o={index:n,states:s};this.httpRequestCurrentDraws(o,a)}}}},this.httpRequestCurrentDraws=function(e,t){var i=this,s=e.states,n=e.index,r=s[n],o={url:"//view.csslcloud.net/api/view/replay/v2/draw/range",param:{starttime:r.startTime,endtime:r.endTime,userid:r.userId,recordid:r.recordId,liveid:r.liveId}};r.httpRequest(o,function(e){var s=e.datas.meta.draw;u.log("*** 预加载成功 callback.draws["+n+"] ***",s),i.draws=a(i.draws,s),i.draws.sort(function(e,t){return parseInt(e.time)-parseInt(t.time)}),t(i.draws),c.state.drawsAlready++})},this.httpRequestStream=function(e){var i=this;if(i.state.isDrawsAlready())return u.log("httpRequestStream draws already",i.draws),u.log("callback.state",c.state),void u.log("snapshoot",t);for(var s=i.state.getStates(),n=0;n<s.length;n++){if(!(o=s[n]).result&&!o.requestState){if(!(i.httpRequestPool.length<i.requestNumber))break;i.httpRequestPool.push(o)}}for(var r=0;r<i.httpRequestPool.length;r++){var o;(o=i.httpRequestPool[r]).result||o.requestState||function(t){var s={url:"//view.csslcloud.net/api/view/replay/v2/draw/range",param:{starttime:t.startTime,endtime:t.endTime,userid:t.userId,recordid:t.recordId,liveid:t.liveId}};t.httpRequest(s,function(s){var n=s.datas.meta.draw;u.log("请求流 draw["+t.key+"]",n),c.isRequestDraws?i.draws=a(i.draws,n):i.draws=i.draws.concat(n),i.draws.sort(function(e,t){return parseInt(e.time)-parseInt(t.time)}),e(i.draws);for(var r=0;r<i.httpRequestPool.length;r++)if(i.httpRequestPool[r].key==t.key){i.httpRequestPool.splice(r,1);break}c.state.drawsAlready++,i.httpRequestStream(e)})}(o)}},this.httpRequestSnapshoot=function(i,s,n){var r=this;if(e.isDrawsAlready())u.log("画笔数据请求完整，不在请求快照数据");else{var o=e.getStates(),l=(s=s,e.getCurrentStateIndex(s)),d=o[l];if(d){var h=t.getSnapshoot(),f=h[i.docId+"_"+i.pageNum+"_"+i.url];if(d.result||f)u.log("当前时间段存在数据或存在快照",l+"");else{u.log("_snapshoot.getSnapshoot()",h),t.requestState&&t.abort();var p={url:"//view.csslcloud.net/api/view/replay/v2/draw/snapshot",param:{docid:i.docId,currentpage:i.pageNum,userid:t.userId,recordid:t.recordId}};t.httpRequest(p,function(e){if(t.setSnapshoot(i.docId+"_"+i.pageNum+"_"+i.url,e),d.result)u.log("快照请求成功，当前时间段数据存在，丢弃快照"+l);else{c.isRequestDraws=!0;var s=e.datas.meta.draw;u.log("*** 快照 callback.draws["+i.docId+"_"+i.pageNum+"_"+i.url+"] ***",s),r.draws=a(r.draws,s),r.draws.sort(function(e,t){return parseInt(e.time)-parseInt(t.time)}),n(r.draws)}})}}}}};t.ListenerDuration=function(){if(on_cc_limit_request_draws){var e=setInterval(function(){parseInt(c.callbackPlayer.getDuration())&&(u.log("ListenerDuration"),on_cc_limit_request_draws&&on_cc_limit_request_draws(),clearInterval(e))},50);t.ListenerDuration=null}},t.on_cc_limit_request_draws=function(){if(d.drawRequestTime){u.log("分页请求画笔数据",d.drawRequestTime);var e=c.callbackPlayer.getDuration()+1;u.log("duration",e+"");var a=Math.ceil(e/d.drawRequestTime),i={blockTime:a,startTime:0,endTime:0+a};c.state.init(i),u.log("callback.state",c.state),setTimeout(function(){c.drawsInfoRequestPool.httpRequestStream(function(e){c.draws=e,c.isHistoryReady=!0,c.drawPanel.isReady=!0})},1e4),setTimeout(function(){p()},1500),t.on_cc_limit_request_draws=null}},t.on_cc_request_snapshoot=function(e){if(d.drawRequestTime){u.log("pageChange",e);var t=c.callbackPlayer.getPlayerTime();c.drawsInfoRequestPool.httpRequestSnapshoot(e,t,function(e){c.draws=e,c.isHistoryReady=!0,c.drawPanel.isReady=!0})}};var l=function(s){this.chatLogs=[],this.broadcasts=[],this.draws=[],this.pageChanges=[],this.isHistoryReady=!1,this.questions=[],this.answers=[],this.pageChanges=[],this.draws=[],this.animations=[],this.pageChangeIndex=-1,this.drawIndex=-1,this.animationIndex=-1,this.isRequestDraws=!1,this.drawPanel=new function(e,a){this.isReady=!1;h.fastMode||swfobject.embedSWF("//zeus.csslcloud.net/flash/Player.swf",e.drawPanel.id,e.drawPanel.width,e.drawPanel.height,"10.0.0","/flash/expressInstall.swf",{type:"drawpanel"},{allowFullscreen:"true",allowScriptAccess:"always",wmode:"transparent"},{}),this.getFlash=function(){if(this.isReady)return swfobject.getObjectById(e.drawPanel.id)},this.clear=function(){h.clear();var e=this.getFlash();e&&e.clear()},this.draw=function(e){h.draw(e);var t=this.getFlash();t&&t.draw(e)},this.draws=function(e){var t=this.getFlash();t&&function(e){setTimeout(function(){t.drawList(e)})}(e)},this.filp=function(e){h.pageChange(e);var a=this.getFlash();if(a){var i=JSON.parse(e),s=i.url;"https:"===t.location.protocol&&(i.url=s.replace(/http:/g,"https:")),d.adapt?a.filp(JSON.stringify(i),"auto"):a.filp(JSON.stringify(i))}},this.animation=function(e){h.animationChange(e);var t=this.getFlash();t&&t.animation(e)},this.intervalNum=0,this.interval=function(){var e=0;try{e=c.callbackPlayer.getPlayerTime()}catch(e){}if(!(e<0)){_&&(w=e,Math.abs(w-y)>=2.5&&seekComplete&&seekComplete(),y=e),c.isRequestDraws&&c.drawsInfoRequestPool.isHttpRequestCurrentDraws(e,function(e){c.draws=e});try{if(c.animations&&c.animations.length>0&&c.animationIndex<c.animations.length&&(n=c.pageChangeIndex)>=0){var a=c.pageChanges[n],i=c.animations[c.animationIndex+1];a&&i&&a.encryptDocId==i.encryptDocId&&e>=i.time&&a.time<=i.time&&(h.fastMode?this.animation(i):this.animation(JSON.stringify({fileName:i.docName,totalPage:i.docTotalPage,docid:i.encryptDocId,url:i.url,page:i.pageNum,step:i.step})),c.animationIndex=c.animationIndex+1)}}catch(e){}try{if(c.pageChanges&&c.pageChanges.length>0&&c.pageChangeIndex<c.pageChanges.length&&e>=(a=c.pageChanges[c.pageChangeIndex+1]).time){"function"==typeof t.on_cc_callback_page_change&&t.on_cc_callback_page_change(a),"function"==typeof t.on_cc_request_snapshoot&&t.on_cc_request_snapshoot(a),h.fastMode?this.filp(a):this.filp(JSON.stringify({fileName:a.docName,totalPage:a.docTotalPage,docid:a.encryptDocId,url:a.url,page:a.pageNum,useSDK:a.useSDK})),c.pageChangeIndex=c.pageChangeIndex+1;var s={};s.docId=a.docId,s.docName=a.docName,s.docTotalPage=a.docTotalPage,s.pageNum=a.pageNum,"function"==typeof t.on_cc_callback_pagechange&&t.on_cc_callback_pagechange(s)}}catch(e){}try{var n;c.animations&&c.animations.length>0&&c.animationIndex<c.animations.length&&(n=c.pageChangeIndex)>=0&&(a=c.pageChanges[n],i=c.animations[c.animationIndex+1],a&&i&&a.encryptDocId==i.encryptDocId&&e>=i.time&&a.time<=i.time&&(h.fastMode?this.animation(i):this.animation(JSON.stringify({fileName:i.docName,totalPage:i.docTotalPage,docid:i.encryptDocId,url:i.url,page:i.pageNum,step:i.step})),c.animationIndex=c.animationIndex+1))}catch(e){}try{if(c.draws&&c.draws.length>0&&c.drawIndex<c.draws.length)for(var r=c.draws[c.drawIndex+1];e>=r.time;)h.fastMode?this.draw(r):this.draw(r.data),c.drawIndex=c.drawIndex+1,r=c.draws[c.drawIndex+1]}catch(e){}}},this.intervalPainting=function(e){e.drawPanel.intervalNum=setInterval(function(){e.drawPanel.interval(e)},1e3)}}(s,this),this.history=new function(s,r){n(s,function(n){var l=n.globalData;n.requestLoginData&&(h.fastMode&&(e("#documentDisplayMode").val(l.datas.room.documentDisplayMode),h.appendDrawPanel(),h.init()),s.chat={host:l.datas.pusherNode.primary},s.viewer.sessionId=l.datas.sessionId,s.liveId=l.datas.encryptLiveId,s.upId=l.datas.upId,s.viewerId=l.datas.viewer.id,r.socket=new i(s),"function"==typeof t.on_cc_callback_player&&t.on_cc_callback_player(l.datas.live.encryptRecordvideoId),f.isH5play?I.init(s):"isMobile"==I.isMobile()&&I.init(s));var c=l.datas.meta;if(c){if(n.requestInfoData){for(var u=c.pageChange,d=0;d<u.length;d++){var v=u[d].url,y="https:"===t.location.protocol;v.indexOf("//")>0&&y&&(v=v.replace("http:","https:"),u[d].url=v)}"function"==typeof t.on_cc_callback_pages&&t.on_cc_callback_pages(u);var w=c.pageChange;w&&w.length&&(w.sort(function(e,t){return parseInt(e.time)-parseInt(t.time)}),r.pageChanges=w);var _=c.animation;_&&_.length&&(_.sort(function(e,t){return parseInt(e.time)-parseInt(t.time)}),r.animations=_);var b=c.broadcast;if(t.chatLogs=c.broadcast,b&&b.length){b.sort(function(e,t){return parseInt(e.time)-parseInt(t.time)});for(var d=0;d<b.length;d++){var q=b[d];"function"==typeof t.on_cc_live_broadcast_msg&&t.on_cc_live_broadcast_msg({content:q.content,time:q.time})}r.broadcasts=b}}if(n.requestChatqaData){var P=c.question;if(P&&P.length){P.sort(function(e,t){return parseInt(e.time)-parseInt(t.time)}),r.questions=P;for(var d=0;d<r.questions.length;d++){var T=P[d];"function"==typeof t.on_cc_live_qa_question&&t.on_cc_live_qa_question({action:"question",value:{id:T.encryptId,content:T.content,userId:T.questionUserId,userName:T.questionUserName,userAvatar:T.questionUserAvatar,isPublish:T.isPublish}})}}var k=c.answer;if(k&&k.length){k.sort(function(e,t){return parseInt(e.time)-parseInt(t.time)}),r.answers=k;for(var d=0;d<r.answers.length;d++){var S=k[d];"function"==typeof t.on_cc_live_qa_answer&&t.on_cc_live_qa_answer({action:"answer",value:{questionId:S.encryptId,content:S.content,userId:S.answerUserId,isPrivate:S.isPrivate,userName:S.answerUserName,userAvatar:S.answerUserAvatar,userRole:S.answerUserRole}})}}var D=c.chatLog;if(t.chatLogs=c.chatLog,D&&D.length){D.sort(function(e,t){return parseInt(e.time)-parseInt(t.time)});for(var d=0;d<D.length;d++){var R=D[d];"function"==typeof t.on_cc_live_chat_msg&&t.on_cc_live_chat_msg({userid:R.userId,username:R.userName,time:R.time,msg:R.content,useravatar:R.userAvatar,userRole:R.userRole,usercustommark:R.userCustomMark})}r.chatLogs=D}t.chatLogs&&t.chatLogs.length&&(t.CHATLOGS=t.chatLogs,g()),t.broadcasts&&t.broadcasts.length&&(t.BROADCASTS=t.broadcasts,m())}if(n.requestDrawData){var C=c.draw;C&&C.length&&(r.draws=C),r.isHistoryReady=!0,r.drawPanel.isReady=!0,setTimeout(function(){p()},1500)}t.on_cc_h5_player_load=function(){if(r.callbackPlayer.isReady=!0,!o){o=!0;var t=a.getElementById("drawPanel");t&&e.Callback.config({playerId:"playbackVideo"},c)}}}});var o=!1}(s,this),this.chatMessageCache=new function(){this.cache=[],this.lastTimeRefresh=(new Date).getTime(),this.INTERVAL_TIME=setInterval(function(){c.chatMessageCache.refresh()},80),this.push=function(e){this.cache.length>5e3||this.cache.push(e)},this.ableRefresh=function(){var e=(new Date).getTime();return 0!=this.cache.length&&e-this.lastTimeRefresh>=80},this.refresh=function(){if(this.ableRefresh()){clearInterval(this.INTERVAL_TIME);for(var e=[],a=Math.min(this.cache.length,10),i=0;i<a;i++)e.push(this.cache.shift());"function"==typeof t.on_cc_live_chat_msg_sync&&t.on_cc_live_chat_msg_sync(e),this.lastTimeRefresh=(new Date).getTime(),this.INTERVAL_TIME=setInterval(function(){c.chatMessageCache.refresh()},80)}}},this.broadcastCache=new function(){this.cache=[],this.lastTimeRefresh=(new Date).getTime(),this.INTERVAL_TIME=setInterval(function(){c.broadcastCache.refresh()},80),this.push=function(e){this.cache.length>5e3||this.cache.push(e)},this.ableRefresh=function(){var e=(new Date).getTime();return 0!=this.cache.length&&e-this.lastTimeRefresh>=80},this.refresh=function(){if(this.ableRefresh()){clearInterval(this.INTERVAL_TIME);for(var e=[],a=Math.min(this.cache.length,10),i=0;i<a;i++)e.push(this.cache.shift());"function"==typeof t.on_cc_live_broadcast_msg_sync&&t.on_cc_live_broadcast_msg_sync(e),this.lastTimeRefresh=(new Date).getTime(),this.INTERVAL_TIME=setInterval(function(){c.broadcastCache.refresh()},80)}}}},c={},u={debug:!1,log:function(e,t){this.debug&&(t?console.log(e+" => ",t):console.log(e))}};t.TIMEOUT=5e3;var d={userId:e("#userId").val(),roomId:e("#roomId").val(),liveId:e("#liveId").val(),recordId:e("#recordId").val(),videoId:e("#videoId").val(),adapt:!1,isShowBar:0,viewerId:e("#viewerId").val(),upId:e("#upId").val(),viewer:{id:e("#viewerId").val(),name:e("#viewerName").val(),role:e("#viewerRole").val(),sessionId:e("#sessionId").val()},callbackPlayer:{id:"playbackPlayer",width:"100%",height:"100%"},drawPanel:{id:"playbackPanel",width:"100%",height:"100%"}},h={dpc:{},fastMode:!1,init:function(){this.dpc=new Dpc},appendDrawPanel:function(){var a='<iframe id="dpa" allow-scripts allowfullscreen allowusermedia frameborder="0" style="width: 100%;height:100%;"></iframe>';"isMobile"==I.isMobile()&&(a='<iframe id="dpa" allow-scripts allowfullscreen allowusermedia frameborder="0" style="width: 100%;height:100%;pointer-events: none;"></iframe>'),e("#playbackPanel").parent().append(a),e("div#playbackPanel").remove(),"function"==typeof t.on_cc_live_db_flip&&t.on_cc_live_db_flip()},pageChange:function(e){this.fastMode&&this.dpc.pageChange(e)},animationChange:function(e){this.fastMode&&this.dpc.animationChange(e)},history:function(e){this.fastMode&&this.dpc.history(e)},draw:function(e){this.fastMode&&this.dpc.draw(e)},clear:function(){this.fastMode&&this.dpc.clear()}};var f={isH5play:!1,fastMode:!1,setFastMode:function(e){"string"==typeof e.fastMode?"false"===e.fastMode?this.fastMode=!1:this.fastMode=!0:"boolean"==typeof e.fastMode?this.fastMode=e.fastMode:this.fastMode=!1},config:function(t){(function(){if(a.createElement("video").canPlayType){var e=a.createElement("video");return oggTest=e.canPlayType('video/ogg; codecs="theora, vorbis"'),oggTest?"probably"==oggTest:(h264Test=e.canPlayType('video/mp4; codecs="avc1.42E01E, mp4a.40.2"'),!!h264Test&&"probably"==h264Test)}return!1})()&&(this.isH5play=t.isH5play),this.setFastMode(t),h.fastMode=this.fastMode;var i=["//static.csslcloud.net/js/socket.io.js","//static.csslcloud.net/js/swfobject.js","//static.csslcloud.net/js/json3.min.js","//static.csslcloud.net/js/module/drawingBoard-2.0.0.js","//static.csslcloud.net/js/module/drawingBoardPlayback.js","//static.csslcloud.net/js/report.js"];h.fastMode&&i.splice(3,2),this.loadScript(i,function(){!function(t){d.viewerId=t.viewerid,d=e.extend(d,t),c=new l(d)}(t),"isMobile"==I.isMobile()&&e.DrawingBoard&&!h.fastMode&&f.appendDrawPanel()})},appendDrawPanel:function(){e("#playbackPanel").parent().append('<canvas id="drawPanel" width="1200" height="1200" style="position: absolute;z-index:2;top:0;left: 0"></canvas><iframe id="dpa" src="" frameborder="0" style="position: absolute;top:0;left: 0"></iframe>'),e("div#playbackPanel").remove()},logout:function(){e.ajax({url:"//view.csslcloud.net/api/callback/logout",type:"GET",dataType:"json",timeout:5e3,xhrFields:{withCredentials:!0},success:function(e){},error:function(e,t,a){}})},getScript:function(e,t){var i=!1,s=a.createElement("script");s.src=e,s.onload=s.onreadystatechange=function(){i||this.readyState&&"loaded"!=this.readyState&&"complete"!=this.readyState||(i=!0,t&&t())},a.body.appendChild(s)},loadScript:function(e,t){if("string"==typeof e){var a=e;(e=[]).push(a)}var i=this,s=function(e,t){i.getScript(e.shift(),function(){e.length?s(e,t):t&&t()})};s(e,t)},playbackRate:function(e){c.callbackPlayer.playbackRate(e)},seek:function(e){clearInterval(c.drawPanel.intervalNum),c.callbackPlayer.seek(e)},getPlayerTime:function(){return c.callbackPlayer.getPlayerTime()},getDuration:function(){return f.isH5play?I.getDuration():"isMobile"==I.isMobile()?I.getDuration():c.callbackPlayer.getDuration()},docAdapt:function(e){d.adapt=e},isShowBar:function(e){d.isShowBar=e},getBuffer:function(){return c.callbackPlayer.getBuffer()},setVolume:function(e){return c.callbackPlayer.setVolume(e)},getVolume:function(){return c.callbackPlayer.getVolume()},play:function(){return c.callbackPlayer.play()},setZScale:function(e){return c.callbackPlayer.setZScale(e)},getZScale:function(){return c.callbackPlayer.getZScale()},setScale:function(e){return c.callbackPlayer.setScale(e)},getScale:function(){return c.callbackPlayer.getScale()},openSettingPanel:function(){return c.callbackPlayer.openSettingPanel()}};function p(){c.isHistoryReady?function e(){c.callbackPlayer.isReady?c.drawPanel.intervalPainting(c):setTimeout(function(){e()},500)}():setTimeout(function(){p()},300)}function g(){setInterval(function(){var a=0;try{a=parseInt(e("#playbackVideo")[0].currentTime,10)}catch(e){}if(!(a<=0)&&t.CHATLOGS.length)for(var i=t.CHATLOGS[0];i.time<=a;){var s=t.CHATLOGS.shift();if(c.chatMessageCache.push({userid:s.userId,username:s.userName,time:s.time,msg:s.content,useravatar:s.userAvatar,userRole:s.userRole,usercustommark:s.userCustomMark}),!t.CHATLOGS.length)break;i=t.CHATLOGS[0]}},1e3)}function m(){setInterval(function(){var a=0;try{a=parseInt(e("#playbackVideo")[0].currentTime,10)}catch(e){}if(!(a<=0)&&t.BROADCASTS.length)for(var i=t.BROADCASTS[0];i.time<=a;){var s=t.BROADCASTS.shift();if(c.broadcastCache.push({content:s.content,time:s.time}),!t.BROADCASTS.length)break;i=t.BROADCASTS[0]}},1e3)}e.extend({DW:f}),t.on_cc_callback_player=function(t){d.videoId=t,c.callbackPlayer=new function(t){this.isReady=!1,this.isPublishing=0,this.id=t.callbackPlayer.id;var a={userid:t.userId,videoid:t.videoId,recordid:t.recordId,isShowBar:t.isShowBar,upid:t.upId,viewerid:t.viewerId,roomid:t.roomId,ua:"1"},i={allowFullscreen:"true",allowScriptAccess:"always",wmode:"transparent"};this.flashPlayerInit=function(){swfobject.embedSWF("//player.csslcloud.net/platform/live/CallbackPlayer.swf",t.callbackPlayer.id,t.callbackPlayer.width,t.callbackPlayer.height,"10.0.0","/flash/expressInstall.swf",a,i),"isMobile"!=I.isMobile()&&new ReportLog(t,0,1,null,!1)},f.isH5play||this.flashPlayerInit(),this.getFlash=function(){return swfobject.getObjectById(this.id)},this.playbackRate=function(e){(f.isH5play||"isMobile"===I.isMobile())&&(e=parseFloat(e),this.getH5player().playbackRate=e)},this.seek=function(e){if(!(e<0))if(f.isH5play||"isMobile"==I.isMobile())this.getH5player().currentTime=e;else{var t=this.getFlash();if(!t)return;t.seek(e)}},this.getFlash=function(){return swfobject.getObjectById(this.id)},this.getH5player=function(){return e("#playbackVideo")[0]},this.getPlayerTime=function(){return this.isReady?(e=f.isH5play||"isMobile"==I.isMobile()?this.getH5player().currentTime:parseInt(this.getFlash().getPosition(),10),isNaN(e)||e<0?0:e):0;var e},this.getDuration=function(){if(f.isH5play||"isMobile"==I.isMobile())return this.getH5player().duration;var e=this.getFlash();return e?e.getDuration():void 0},this.getBuffer=function(){if(f.isH5play||"isMobile"==I.isMobile())return this.getH5player().buffered.end(0);var e=this.getFlash();return e?e.getBufferLength():void 0},this.setVolume=function(e){if(!f.isH5play&&"isMobile"!=I.isMobile()){var t=this.getFlash();if(!t)return;return t.setVolume(e)}this.getH5player().volume=parseFloat(e)},this.getVolume=function(){if(f.isH5play||"isMobile"==I.isMobile())return this.getH5player().volume;var e=this.getFlash();return e?e.getVolume():void 0},this.play=function(){if(!f.isH5play&&"isMobile"!=I.isMobile()){var e=this.getFlash();if(!e)return;return e.isPlay()}I.pauseState?this.getH5player().play():this.getH5player().pause()},this.setZScale=function(e){var t=this.getFlash();if(t)return t.setZScale(e)},this.getZScale=function(){var e=this.getFlash();if(e)return e.getZScale()},this.setScale=function(e){var t=this.getFlash();if(t)return t.setScale(e)},this.getScale=function(){var e=this.getFlash();if(e)return e.getScale()},this.openSettingPanel=function(){var e=this.getFlash();if(e)return e.openSettingPanel()}}(d)},t.on_cc_live_player_init=function(){c.callbackPlayer.isReady=!0;try{c.callbackPlayer.getFlash().start()}catch(e){}(setInterval(function(){var e=0;try{e=c.callbackPlayer.getPlayerTime()}catch(e){}if(!(e<=0)&&c.chatLogs.length)for(var t=c.chatLogs[0];t.time<=e&&(t=c.chatLogs.shift(),c.chatMessageCache.push({userid:t.userId,username:t.userName,time:t.time,msg:t.content,useravatar:t.userAvatar,userRole:t.userRole,usercustommark:t.userCustomMark}),c.chatLogs.length);)t=c.chatLogs[0]},1e3),setInterval(function(){var e=0;try{e=c.callbackPlayer.getPlayerTime()}catch(e){}if(!(e<=0)&&c.broadcasts.length)for(var t=c.broadcasts[0];t.time<=e&&(t=c.broadcasts.shift(),c.broadcastCache.push({content:t.content,time:t.time}),c.broadcasts.length);)t=c.broadcasts[0]},1e3),"function"==typeof t.on_cc_live_player_load&&t.on_cc_live_player_load(),on_cc_limit_request_draws)&&(parseInt(c.callbackPlayer.getDuration())?on_cc_limit_request_draws&&on_cc_limit_request_draws():ListenerDuration&&ListenerDuration())},t.seekStart=function(){clearInterval(c.drawPanel.intervalNum)},t.seekComplete=function(){c.drawPanel.clear();var e=c.callbackPlayer.getPlayerTime();e<0&&(e=0),c.pageChangeIndex=-1,c.drawIndex=-1,c.animationIndex=-1;var a={pageChange:[],animation:[],draw:[]};if(c.pageChanges&&c.pageChanges.length>0){for(var i=0;i<c.pageChanges.length;i++){e>=(s=c.pageChanges[i]).time&&(c.pageChangeIndex=i)}if(c.pageChangeIndex>=0){var s=c.pageChanges[c.pageChangeIndex];"function"==typeof t.on_cc_callback_page_change&&t.on_cc_callback_page_change(s),"function"==typeof t.on_cc_request_snapshoot&&t.on_cc_request_snapshoot(s),c.drawPanel.filp(JSON.stringify({fileName:s.docName,totalPage:s.docTotalPage,docid:s.encryptDocId,url:s.url,page:s.pageNum,useSDK:s.useSDK})),a.pageChange.push(s)}}if(c.animations&&c.animations.length>0){for(i=0;i<c.animations.length;i++){e>=(r=c.animations[i]).time&&(c.animationIndex=i)}if(c.animationIndex>=0){var n=c.pageChangeIndex;if(n>=0){s=c.pageChanges[n];var r=c.animations[c.animationIndex];s&&r&&s.encryptDocId==r.encryptDocId&&e>=r.time&&s.time<=r.time&&(c.drawPanel.animation(JSON.stringify({fileName:r.docName,totalPage:r.docTotalPage,docid:r.encryptDocId,url:r.url,page:r.pageNum,step:r.step})),a.animation.push(r))}}}if(c.draws&&c.draws.length>0){for(i=0;i<c.draws.length;i++){e>=(u=c.draws[i]).time&&(c.drawIndex=i)}var o=c.draws.slice(0,c.drawIndex+1);if(o.length>0){var l=[];for(i=0;i<o.length;i++){var u=o[i];l.push(u.data),a.draw.push(u)}c.drawPanel.draws(l)}}h.history(a),c.drawPanel.intervalNum=setInterval(function(){c.drawPanel.interval()},1e3)};var v={};v.addEvents=function(e,t,i){a.addEventListener?v.addEvents=function(e,t,a){e.addEventListener(t,a,!1)}:v.addEvents=function(e,t,a){e.attachEvent("on"+t,function(){a.call(e,arguments)})},v.addEvents(e,t,i)};var y=0,w=0,_=!0,I={pauseState:!1,init:function(a){var i=this;e.ajax({url:"//view.csslcloud.net/api/vod/play/mobile",type:"GET",dataType:"jsonp",data:{userid:a.userId,videoid:a.videoId},success:function(e){var s=e.video[0],n=s.playurl,r=s.secureplayurl;"https:"===t.location.protocol&&r&&(n=r),i.appendVideo(n,a)}})},appendVideo:function(i,s){var n=this,r='<video id="playbackVideo" webkit-playsinline playsinline controls autoplay x-webkit-airplay="deny" x5-playsinline width="100%" height="100%" src="'+i+'"></video>';e("#"+playbackPlayer.id).html(r);var o=a.getElementById("playbackVideo");s.isShowBar&&o.removeAttribute("controls");var l=0,u=1;"isMobile"==I.isMobile()&&(l=1,u=11);new ReportLog(s,l,u,o,!1);this.isAndroid()||(this.pauseState=!0),v.addEvents(o,"canplay",function(){("isMobile"==I.isMobile()?(t.on_cc_live_player_load&&t.on_cc_live_player_load(),t.on_cc_h5_player_load&&t.on_cc_h5_player_load()):f.isH5play&&t.on_cc_live_player_init&&t.on_cc_live_player_init(),on_cc_limit_request_draws)&&(parseInt(c.callbackPlayer.getDuration())?on_cc_limit_request_draws&&on_cc_limit_request_draws():ListenerDuration&&ListenerDuration())},!1),v.addEvents(o,"playing",function(){n.pauseState=!1,t.on_player_start&&on_player_start(),t.on_spark_player_resume&&on_spark_player_resume()},!1),v.addEvents(o,"pause",function(){n.pauseState=!0,t.on_spark_player_pause&&on_spark_player_pause()},!1),v.addEvents(o,"ended",function(){t.on_spark_player_end&&on_spark_player_end()},!1),v.addEvents(o,"seeking",function(){_=!1,seekStart&&seekStart()},!1),v.addEvents(o,"seeked",function(){_=!1,seekComplete&&seekComplete()},!1)},getDuration:function(){var e=a.getElementById("playbackVideo");if(e)return Math.floor(e.duration)},getPlayerTime:function(){var e=a.getElementById("playbackVideo");if(e)return Math.floor(e.currentTime)},end:function(){e("#"+playbackPlayer.id).html("end")},appendDoc:function(t){var a='<img src="'+t+'" />';e("#"+playbackPanel.id).append(a)},isMobile:function(){if(this.isIPad()||this.isIPhone()||this.isAndroid()||this.isWindowsPhone())return"isMobile"},isIPad:function(){return null!=navigator.userAgent.match(/iPad/i)},isIPhone:function(){return null!=navigator.userAgent.match(/iPhone/i)},isAndroid:function(){return null!=navigator.userAgent.match(/Android/i)},isWindowsPhone:function(){return null!=navigator.userAgent.match(/Windows Phone/i)}}}(jQuery,window,document)}]);
//# sourceMappingURL=playbackSDK.min.js.map